var ChronoZoom;(function(n){(function(t){function ft(n,t){var i,r;return i=t.pageX-n[0].offsetLeft,r=t.pageY-n[0].offsetTop,{x:i,y:r}}function et(n){n&&n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function ot(n){return n===9999?0:g(n,0,0)}function g(n,t,i){var r=a();return nt(n,t,i,r.presentYear,r.presentMonth,r.presentDay)}function st(n){var t=a();return ht(t.presentYear,t.presentMonth,t.presentDay,n)}function a(){return f||(f=new Date,f.presentDay=f.getUTCDate(),f.presentMonth=f.getUTCMonth(),f.presentYear=f.getUTCFullYear()),f}function nt(n,t,r,u,f,e){var h=u-n,c,o,s,l,a;for(u>0&&n<0&&(h-=1),c=f-t,(t>f||t==f&&r>e)&&(h--,c+=12),o=t,s=-r,l=0;l<c;l++)o==12&&(o=0),s+=i.daysInMonth[o],o++;return s+=e,a=h+s/365,-a}function ht(n,t,r,u){var e=n,f=t,o=r,s,c,h;for(e-=Math.floor(-u),s=(u+Math.floor(-u))*365;s<0;)c=f>0?f-1:11,s+=i.daysInMonth[c],f--,f<0&&(e--,f=11);for(o+=Math.round(s),h=i.daysInMonth[f];o>h;)o-=h,f++,f>11&&(f=0,e++),h=i.daysInMonth[f];return e<0&&n>0&&(e-=1),{year:e,month:f,day:o}}function ct(n,t){var u;t||(t="jpg");var i=$("#"+n).attr("src"),r=i.length,f=i.substring(0,r-7);i.substring(r-6,r-4)=="on"&&(u=f+"_off."+t,$("#"+n).attr("src",u))}function lt(n,t){var u;t||(t="jpg");var i=$("#"+n).attr("src"),r=i.length,f=i.substring(0,r-7);i.substring(r-6,r-4)=="ff"&&(u=f+"on."+t,$("#"+n).attr("src",u))}function vt(n){return u.pauseTourAtAnyAnimation=!1,u.tour!=undefined&&u.tour.state=="play"&&u.tourPause(),yt(n)}function yt(n){if(n)return rt.moveToVisible(n)}function pt(t){if(timings.wcfRequestCompleted=new Date,n.Layout.Load(r,t.d),timings.layoutCompleted=new Date,o&&(s=n.UrlNav.navStringToVisible(o.substring(1),r)),tt(),!s&&e&&(window.location.hash=e,s=n.UrlNav.navStringToVisible(e,r)),s){r.virtualCanvas("setVisible",s),it(r,h);var i=r.virtualCanvas("getViewport");wt(i),o&&window.location.hash!==o&&(hashChangeFromOutside=!1,window.location.hash=o)}timings.canvasInited=new Date}function tt(){var f,u,o,s,h,l;c&&c.d.length>0&&(f=function(t){if(!t)return null;var i=r.virtualCanvas("findElement","t"+t.UniqueID);return ut.push(i),i&&(i=n.UrlNav.vcelementToNavString(i)),i},u=c.d[0],e=f(u),n.UrlNav.navigationAnchor=r.virtualCanvas("findElement","t"+u.UniqueID),o=n.Layout.FindChildTimeline(u,i.earthTimelineID),p=f(o),s=n.Layout.FindChildTimeline(o,i.lifeTimelineID),w=f(s),h=n.Layout.FindChildTimeline(s,i.prehistoryTimelineID),b=f(h),l=n.Layout.FindChildTimeline(h,i.humanityTimelineID,!0),k=f(l),t.maxPermitedVerticalRange={top:u.y,bottom:u.y+u.height},t.maxPermitedScale=n.UrlNav.navStringToVisible(e,r).scale*1.1)}function it(n,t){var i=n.virtualCanvas("getViewport"),r=i.pointScreenToVirtual(0,0),u=i.pointScreenToVirtual(i.width,i.height);t.axis("setRange",r.x,u.x)}function wt(n){var f=function(n){if(Math.abs(n)<1e-11)return 0;var t=Math.log(n)/2.3025850929940459,i=Math.pow(t,3)*Math.exp(-t*.001);return(t+i)*137e8/1041.2113538234403},r=n.pointScreenToVirtual(0,0).x,t;r<i.maxPermitedTimeRange.left&&(r=i.maxPermitedTimeRange.left),t=n.pointScreenToVirtual(n.width,n.height).x,t>i.maxPermitedTimeRange.right&&(t=i.maxPermitedTimeRange.right);var s=f(Math.abs(t)),e=f(Math.abs(r)),h=Math.max(2/v,Math.abs(s-e)),c=document.getElementById("cosmos_rect").clientWidth,u=301-v*e,o=v*h;u<0||u+o>c+5||(d.css("left",u),d.css("width",o))}var i=n.Settings,u=n.Tours,f,y,at;t.maxPermitedScale,t.maxPermitedVerticalRange;var rt,o,h,r,s,e,p,w,b,k,c,ut=[],v,d,l=undefined;t.getXBrowserMouseOrigin=ft,t.preventbubble=et,t.getCoordinateFromDecimalYear=ot,t.getCoordinateFromDMY=g,t.getDMYFromCoordinate=st,f=undefined,t.getPresent=a,t.toggleOffImage=ct,t.toggleOnImage=lt,y=null,at="default",t.setVisibleByUserDirectly=vt})(n.Common||(n.Common={}));var t=n.Common})(ChronoZoom||(ChronoZoom={}))