var CZ=function(n,t){var i=n.Service=n.Service||{},r;return i.Map=i.Map||{},r=serverUrlHost+"/chronozoom.svc/",i.Request=function(n){var t=n,i=!1;Object.defineProperty(this,"url",{configurable:!1,get:function(){return t}}),this.addToPath=function(n){n&&(t+=t.match(/\/$/)?n:"/"+n)},this.addParameter=function(n,r){r!=="undefined"&&r!==null&&(t+=i?"&":"?",t+=n+"="+r,i=!0)},this.addParameters=function(n){for(var t in n)n.hasOwnProperty(t)&&this.addParameter(t,n[t])}},t.extend(i.Map,{timeline:function(n){return{Id:n.guid,ParentTimelineId:n.parent.guid,FromYear:n.x,ToYear:n.x+n.width,Title:n.title,Regime:n.regime}},exhibit:function(n){return{Id:n.guid||null,ParentTimelineId:n.parent.guid,Year:n.infodotDescription.date,Title:n.title,description:undefined,contentItems:undefined}},contentItem:function(n){return{Id:n.guid||null,ParentExhibitId:n.parent,Title:n.contentItem?n.contentItem.title:n.title,Caption:n.contentItem?n.contentItem.description:n.description,Uri:n.contentItem?n.contentItem.uri:n.uri,MediaType:n.contentItem?n.contentItem.mediaType:n.mediaType}}}),t.extend(i,{collectionName:"sandbox",superCollectionName:"sandbox",get:function(){var u=new i.Request(r);return u.addToPath("get"),u.addParameter("supercollection",n.Service.superCollectionName),u.addParameter("collection",n.Service.collectionName),t.ajax({type:"GET",cache:!1,dataType:"json",url:u.url})},getTimelines:function(n){var u=new i.Request(r);return u.addToPath("gettimelines"),u.addParameter("supercollection",i.superCollectionName),u.addParameter("collection",i.collectionName),u.addParameters(n),console.log("[GET] "+u.url),t.ajax({type:"GET",cache:!1,dataType:"json",url:u.url})},getCollections:function(){var n=new i.Request(r);return n.addToPath(i.superCollectionName),n.addToPath("collections"),t.ajax({type:"GET",cache:!1,dataType:"json",url:n.url})},getStructure:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("structure"),u.addParameters(n),t.ajax({type:"GET",cache:!1,dataType:"json",url:u.url})},postData:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("data"),t.ajax({type:"POST",cache:!1,contentType:"application/json",dataType:"json",url:u.url,data:JSON.stringify(n)})},putCollection:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(n.name),t.ajax({type:"PUT",cache:!1,contentType:"application/json",dataType:"json",url:u.url,data:JSON.stringify(n)})},deleteCollection:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(n.name),t.ajax({type:"DELETE",cache:!1,contentType:"application/json",url:u.url,data:JSON.stringify(n)})},putTimeline:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("timeline"),console.log("[PUT] "+u.url),t.ajax({type:"PUT",cache:!1,contentType:"application/json",dataType:"json",url:u.url,data:JSON.stringify(i.Map.timeline(n))})},deleteTimeline:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("timeline"),console.log("[DELETE] "+u.url),t.ajax({type:"DELETE",cache:!1,contentType:"application/json",url:u.url,data:JSON.stringify(i.Map.timeline(n))})},putExhibit:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("exhibit"),console.log("[PUT] "+u.url),t.ajax({type:"PUT",cache:!1,contentType:"application/json",dataType:"json",url:u.url,data:JSON.stringify(i.Map.exhibit(n))})},deleteExhibit:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("exhibit"),console.log("[DELETE] "+u.url),t.ajax({type:"DELETE",cache:!1,contentType:"application/json",url:u.url,data:JSON.stringify(i.Map.exhibit(n))})},putContentItem:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("contentitem"),console.log("[PUT] "+u.url),t.ajax({type:"PUT",cache:!1,contentType:"application/json",dataType:"json",url:u.url,data:JSON.stringify(i.Map.contentItem(n))})},deleteContentItem:function(n){var u=new i.Request(r);return u.addToPath(i.superCollectionName),u.addToPath(i.collectionName),u.addToPath("contentitem"),console.log("[DELETE] "+u.url),t.ajax({type:"DELETE",cache:!1,contentType:"application/json",url:u.url,data:JSON.stringify(i.Map.contentItem(n))})},putExhibitContent:function(n,r){var u=n.contentItems.map(function(n){return n.guid}),f=n.contentItems.map(function(n){return i.putContentItem(n)}).concat(r.filter(function(n){return u.indexOf(n.guid)===-1}).map(function(n){return i.deleteContentItem(n)}));return t.when.apply(t,f)}}),n}(CZ||{},jQuery)