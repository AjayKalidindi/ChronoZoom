var ChronoZoom;(function(n){(function(n){function g(n,t,i){var f=2*(contentScaleMargin?contentScaleMargin:0),u=i.width-f,e,r,o,s;return u<0&&(u=i.width),e=t*n.width/u,r=i.height-f,r<0&&(r=i.height),o=t*n.height/r,s={centerX:n.x+n.width/2,centerY:n.y+n.height/2,scale:Math.max(e,o)},s}function t(n,t,i,r,u,f,e){this.vc=n,this.id=i,this.layerid=t,this.x=r,this.y=u,this.width=f,this.height=e,this.children=[],this.isVisible=function(n){var t=this.x+this.width,i=this.y+this.height;return Math.max(this.x,n.Left)<=Math.min(t,n.Right)&&Math.max(this.y,n.Top)<=Math.min(i,n.Bottom)},this.isInside=function(n){return n.x>=this.x&&n.x<=this.x+this.width&&n.y>=this.y&&n.y<=this.y+this.height},this.render=function(){}}function f(n,t,r,u,f,e,o,s,h,c){return i(n,new ut(n.vc,t,r,u,f,e,o,s,h,c),!1)}function wt(n,t,r,u,f,e,o,s,h){return i(n,new v(n.vc,t,r,u,f,e,o,s,h),!1)}function w(n){n.isRendered=!1,n.onIsRenderedChanged&&n.onIsRenderedChanged();for(var t=n.children.length;--t>=0;)n.children[t].isRendered&&w(n.children[t])}function tt(n){for(var r=n.children.length,t,i=0;i<r;i++)t=n.children[i],tt(t),t.onRemove&&t.onRemove(),t.parent=null;n.children=[]}function bt(n,t){for(var r=n.children.length,i=0;i<r;i++)if(n.children[i].id==t)return n.children[i];throw"There is no child with id ["+t+"]";}function kt(n,i,r,u,f,e,o){this.base=t,this.base(n,i,r,u,f,e,o),this.isVisible=function(){return this.children.length!=0},this.beginEdit=function(){return this},this.endEdit=function(n){n||this.vc.invalidate()},this.isInside=function(){return!0},this.render=function(t,i,r){var f,u;if(this.vc.breadCrumbs=[],this.isVisible(i)){for(f=this.children.length,u=0;u<f;u++)nt(this.children[u],t,i,r,1);this.vc.breadCrumbs.length>0&&(this.vc.recentBreadCrumb==undefined||this.vc.breadCrumbs[n.breadCrumbs.length-1].vcElement.title!=this.vc.recentBreadCrumb.vcElement.title)?(this.vc.recentBreadCrumb=this.vc.breadCrumbs[n.breadCrumbs.length-1],this.vc.breadCrumbsChanged()):this.vc.breadCrumbs.length==0&&this.vc.recentBreadCrumb!=undefined&&(this.vc.recentBreadCrumb=undefined,this.vc.breadCrumbsChanged())}}}function dt(n){var t=Math.max(n.x,n.y),r,i;if(t<=1)return 0;for(r=t&1?1:0,i=1;i<32;i++)t=t>>>1,t&1&&(r=r>0?i+1:i);return r}function u(n,r,u,f,o,s,h){var c,l,a;this.base=t,this.base(n,r,u,f,o,s,h),this.zoomLevel=0,this.prevContent=null,this.newContent=null,this.asyncContent=null,this.lastRenderTime=0,c=this,this.changeZoomLevel=function(){return null},l=function(n){c.lastRenderTime=new Date,c.prevContent=c.content,c.content=n.content,i(c,c.content,!1),c.prevContent&&(c.prevContent.opacity||(c.prevContent.opacity=1),c.content.opacity=0),c.zoomLevel=n.zoomLevel},a=function(){c.asyncContent&&(l(c.asyncContent),c.asyncContent=null,delete this.onLoad,c.vc.requestInvalidate())},this.render=function(n,t,i,r){var s,f,h,v;if(!this.asyncContent&&(this.prevContent||(s=dt(r),this.zoomLevel!=s&&(f=this.changeZoomLevel(this.zoomLevel,s),f&&(f.content.isLoading?(this.asyncContent=f,f.content.onLoad=a):l(f)))),this.prevContent)){h=new Date,v=h-c.lastRenderTime,c.lastRenderTime=h;var y=v/1600,o=!1,u=this.prevContent.opacity;u=Math.max(0,u-y),u!=this.prevContent.opacity&&(o=!0),u==0?(e(this,this.prevContent.id),this.prevContent=null):this.prevContent.opacity=u,u=this.content.opacity,u=Math.min(1,u+y),o||u==this.content.opacity||(o=!0),this.content.opacity=u,o&&this.vc.requestInvalidate()}},this.onIsRenderedChanged=function(){typeof this.removeWhenInvisible!="undefined"&&this.removeWhenInvisible&&(this.isRendered||(this.asyncContent&&(this.asyncContent=null),this.prevContent&&(e(this,this.prevContent.id),this.prevContent=null),this.newContent&&(e(this,this.newContent.id),this.newContent.content.onLoad=null,this.newContent=null),this.content&&(e(this,this.content.id),this.content=null),this.zoomLevel=0))}}function o(n,i,r,u,f,e,o){this.base=t,this.base(n,i,r,u,f,e,o),this.render=function(){}}function l(n,i,r,u,f,e,o,s){this.base=t,this.base(n,i,r,u,f,e,o),this.settings=s,this.render=function(n,t,i,r,u){var e=i.pointVirtualToScreen(this.x,this.y),o=i.pointVirtualToScreen(this.x+this.width,this.y+this.height),s=Math.max(0,e.x),h=Math.max(0,e.y),c=Math.min(i.width,o.x),l=Math.min(i.height,o.y),v,a,y,f;s<c&&h<l&&(this.settings.fillStyle&&(v=this.settings.gradientOpacity?u*(1-this.settings.gradientOpacity):u,n.globalAlpha=v,n.fillStyle=this.settings.fillStyle,n.fillRect(s,h,c-s,l-h),this.settings.gradientOpacity&&this.settings.gradientFillStyle&&(a=n.createLinearGradient(s,l,c,h),y="rgba(0, 0, 0, 0)",a.addColorStop(0,this.settings.gradientFillStyle),a.addColorStop(1,y),n.globalAlpha=u*this.settings.gradientOpacity,n.fillStyle=a,n.fillRect(s,h,c-s,l-h))),n.globalAlpha=u,this.settings.strokeStyle&&(n.strokeStyle=this.settings.strokeStyle,n.lineWidth=this.settings.lineWidth?this.settings.isLineWidthVirtual?i.widthVirtualToScreen(this.settings.lineWidth):this.settings.lineWidth:1,f=n.lineWidth/2,this.settings.outline&&(e.x+=f,e.y+=f,h+=f,l-=f,s+=f,c-=f,o.x-=f,o.y-=f),e.x>0&&(n.beginPath(),n.moveTo(e.x,h-f),n.lineTo(e.x,l+f),n.stroke()),e.y>0&&(n.beginPath(),n.moveTo(s-f,e.y),n.lineTo(c+f,e.y),n.stroke()),o.x<i.width&&(n.beginPath(),n.moveTo(o.x,h-f),n.lineTo(o.x,l+f),n.stroke()),o.y<i.height&&(n.beginPath(),n.moveTo(s-f,o.y),n.lineTo(c+f,o.y),n.stroke())))}}function it(n,t,i,r,u,e,o,s,h){this.base=l,this.base(n,t,i,r,u,e,o),this.settings=s,this.parent=undefined,this.currentlyObservedTimelineEvent=n.currentlyObservedTimelineEvent,this.settings.outline=!0,this.type="timeline";var w=h.timeEnd-h.timeStart,a=h.titleRect?h.titleRect.height:timelineHeaderSize*h.height,y=h.titleRect?h.titleRect.marginLeft:timelineHeaderMargin*h.height,v=h.titleRect?h.titleRect.marginTop:(1-timelineHeaderMargin)*h.height-a,p=h.top+v+a/2;this.titleObject=f(this,t,i+"__header__",h.timeStart+y,h.top+v,p,a,h.header,{fontName:timelineHeaderFontName,fillStyle:timelineHeaderFontColor,textBaseline:"middle"}),this.title=this.titleObject.text,this.regime=h.regime,this.settings.gradientOpacity=0,this.settings.gradientFillStyle=h.strokeStyle?h.strokeStyle:timelineBorderColor,this.reactsOnMouse=!0,this.tooltipEnabled=!0,this.tooltipIsShown=!1,this.onmouseclick=function(n){return c(this,n,1)},this.onmousehover=function(){if(this.vc.currentlyHoveredTimeline!=null&&this.vc.currentlyHoveredTimeline.id!=i)try{this.vc.currentlyHoveredInfodot.id}catch(t){stopAnimationTooltip(),this.vc.currentlyHoveredTimeline.tooltipIsShown=!1}if(this.vc.currentlyHoveredTimeline=this,this.settings.strokeStyle=timelineHoveredBoxBorderColor,this.settings.lineWidth=timelineHoveredLineWidth,this.titleObject.settings.fillStyle=timelineHoveredHeaderFontColor,this.settings.hoverAnimationDelta=3/60,this.vc.requestInvalidate(),this.titleObject.initialized==!1){var n=this.vc.getViewport();this.titleObject.screenFontSize=timelineHeaderSize*n.heightVirtualToScreen(this.height)}if(this.tooltipEnabled=this.titleObject.screenFontSize<=timelineTooltipMaxHeaderSize?!0:!1,tooltipMode!="infodot"){if(tooltipMode="timeline",this.tooltipEnabled==!1){stopAnimationTooltip(),this.tooltipIsShown=!1;return}if(this.tooltipIsShown==!1){switch(this.regime){case"Cosmos":$(".bubbleInfo").attr("id","cosmosRegimeBox");break;case"Earth":$(".bubbleInfo").attr("id","earthRegimeBox");break;case"Life":$(".bubbleInfo").attr("id","lifeRegimeBox");break;case"Pre-history":$(".bubbleInfo").attr("id","prehistoryRegimeBox");break;case"Humanity":$(".bubbleInfo").attr("id","humanityRegimeBox")}$(".bubbleInfo span").text(this.title),this.panelWidth=$(".bubbleInfo").outerWidth(),this.panelHeight=$(".bubbleInfo").outerHeight(),this.tooltipIsShown=!0,animationTooltipRunning=$(".bubbleInfo").fadeIn()}}},this.onmouseunhover=function(){this.vc.currentlyHoveredTimeline!=null&&this.vc.currentlyHoveredTimeline.id==i&&(this.vc.currentlyHoveredTimeline=null,this.tooltipIsShown==!0&&tooltipMode=="timeline"&&(tooltipMode="default",stopAnimationTooltip(),$(".bubbleInfo").attr("id","defaultBox"),this.tooltipIsShown=!1)),this.settings.strokeStyle=h.strokeStyle?h.strokeStyle:timelineBorderColor,this.settings.lineWidth=timelineLineWidth,this.titleObject.settings.fillStyle=timelineHeaderFontColor,this.settings.hoverAnimationDelta=-3/60,this.vc.requestInvalidate()},this.base_render=this.render,this.render=function(t,i,r,u,f){var o;this.titleObject.initialized=!1,this.settings.hoverAnimationDelta&&(this.settings.gradientOpacity=Math.min(1,Math.max(0,this.settings.gradientOpacity+this.settings.hoverAnimationDelta))),this.base_render(t,i,r,u,f),this.settings.hoverAnimationDelta&&(this.settings.gradientOpacity==0||this.settings.gradientOpacity==1?this.settings.hoverAnimationDelta=undefined:this.vc.requestInvalidate());var e=r.pointVirtualToScreen(this.x,this.y),s={x:e.x+u.x,y:e.y+u.y},h=r.visible.centerX-timelineCenterOffsetAcceptableImplicity<=this.x+this.width&&r.visible.centerX+timelineCenterOffsetAcceptableImplicity>=this.x&&r.visible.centerY-timelineCenterOffsetAcceptableImplicity<=this.y+this.height&&r.visible.centerY+timelineCenterOffsetAcceptableImplicity>=this.y,c=e.x<timelineBreadCrumbBorderOffset&&s.x>r.width-timelineBreadCrumbBorderOffset||e.y<timelineBreadCrumbBorderOffset&&s.y>r.height-timelineBreadCrumbBorderOffset;if(c&&h){if(o=n.breadCrumbs.length,o>1&&n.breadCrumbs[o-1].vcElement.parent.id==this.parent.id)return;n.breadCrumbs.push({vcElement:this})}}}function a(n,i,r,u,f,e,o){this.base=t,this.base(n,i,r,u-e,f-e,2*e,2*e),this.settings=o,this.isObservedNow=!1,this.render=function(n,t,i,r,u){var f=this.width/2,o=this.x+f,s=this.y+f,e=i.pointVirtualToScreen(o,s),h=i.widthVirtualToScreen(f);n.globalAlpha=u,n.beginPath(),n.arc(e.x,e.y,h,0,Math.PI*2,!0),this.settings.strokeStyle&&(n.strokeStyle=this.settings.strokeStyle,n.lineWidth=this.settings.lineWidth?this.settings.isLineWidthVirtual?i.widthVirtualToScreen(this.settings.lineWidth):this.settings.lineWidth:1,n.stroke()),this.settings.fillStyle&&(n.fillStyle=this.settings.fillStyle,n.fill())},this.isInside=function(n){var t=sqr(n.x-u)+sqr(n.y-f);return t<=e*e}}function rt(n,t,i,r,u,f){var o=$.browser,h=o.msie&&parseInt(o.version,10)>=9;if(h)t.font=u+"pt "+f,t.fillText(n,i,r);else{var s=12,c=u,e=c/s;t.scale(e,e),t.font=s+"pt "+f,t.fillText(n,i/e,r/e),t.scale(1/e,1/e)}}function ut(n,i,r,u,f,e,o,s,h,c){this.base=t,this.base(n,i,r,u,f,c?c:0,o),this.text=s,this.baseline=e,this.settings=h,typeof this.settings.textBaseline!="undefined"&&this.settings.textBaseline==="middle"&&(this.baseline=this.y+this.height/2),this.initialized=!1,this.screenFontSize=0,this.render=function(n,t,i,r,u){var e=i.pointVirtualToScreen(this.x,this.y),a=i.pointVirtualToScreen(this.x,this.baseline).y,f,h,b,v,s,nt,it,o,p,w;if(n.globalAlpha=u,n.fillStyle=this.settings.fillStyle,f=r.y,h=1.5,this.screenFontSize!=f&&(this.screenFontSize=f),!this.initialized){if(this.settings.wrapText){for(b=this.settings.numberOfLines?this.settings.numberOfLines:1,this.settings.numberOfLines=b,f=r.y/b/h;;){n.font=f+"pt "+this.settings.fontName;var tt=this.text.split("\n"),k=0,d=[];for(v=0;v<tt.length;v++){var y=tt[v].split(" "),c=0,l="",g,ut=n.measureText(" ").width;for(s=0;s<y.length;s++)g=n.measureText(y[s]),nt=c==0?c+g.width:c+g.width+ut,nt>r.x&&c>0?(d.push(l),c=0,k+=f*h,s--,l=""):(l===""?l=y[s]:l+=" "+y[s],c=nt);d.push(l),k+=f*h}if(k>r.y)f/=1.5;else{this.text=d,it=i.heightScreenToVirtual(f),this.settings.fontSizeVirtual=it;break}}this.screenFontSize=f}else n.font=f+"pt "+this.settings.fontName,this.screenFontSize=f,this.width==0?(o=n.measureText(this.text),r.x=o.width,this.width=i.widthScreenToVirtual(o.width)):(o=n.measureText(this.text),o.width>r.x?(this.height=this.width*r.y/o.width,this.settings.textBaseline==="middle"&&(this.y=this.baseline-this.height/2),f=i.heightVirtualToScreen(this.height),this.screenFontSize=f):typeof this.settings.adjustWidth&&this.settings.adjustWidth&&(p=i.widthScreenToVirtual(o.width),this.settings.textAlign==="center"?this.x=this.x+(this.width-p)/2:this.settings.textAlign==="right"&&(this.x=this.x+this.width-p),this.width=p,e=i.pointVirtualToScreen(this.x,this.y),r.x=i.widthVirtualToScreen(this.width)));this.initialized=!0}if(this.settings.textAlign&&(n.textAlign=this.settings.textAlign,this.settings.textAlign==="center"?e.x=e.x+r.x/2:this.settings.textAlign==="right"&&(e.x=e.x+r.x)),this.settings.wrapText)for(f=i.heightVirtualToScreen(this.settings.fontSizeVirtual),this.screenFontSize=f,n.textBaseline="middle",a=e.y+f*h/2,w=0;w<this.text.length;w++)rt(this.text[w],n,e.x,a,f,this.settings.fontName),a+=f*h;else this.settings.textBaseline&&(n.textBaseline=this.settings.textBaseline),rt(this.text,n,e.x,a,f,this.settings.fontName)},this.isVisible=function(n){var t=this.y+this.height,i;return this.width>0?(i=this.x+this.width,Math.max(this.x,n.Left)<=Math.min(i,n.Right)&&Math.max(this.y,n.Top)<=Math.min(t,n.Bottom)):Math.max(this.y,n.Top)<=Math.min(t,n.Bottom)}}function ft(n,i,r,u,f,e,o,s,h){this.base=t,this.base(n,i,r,u,f,e*10,e),this.settings=h,this.text=o,this.render=function(n,t,i,r){function e(n,t,i,r,u,f){var h,c;if(f=f||0,f<=0){n.fillText(t,i,r);return}for(var o=t.split(" "),s=0,e=1;o.length>0&&e<=o.length;)h=o.slice(0,e).join(" "),c=n.measureText(h).width,c>f?(e==1&&(e=2),n.fillText(o.slice(0,e-1).join(" "),i,r+u*s),s++,o=o.splice(e-1),e=1):e++;e>0&&n.fillText(o.join(" "),i,r+u*s)}var f=i.pointVirtualToScreen(this.x,this.y),u;n.fillStyle=h.fillStyle,n.font=r.y+"pt "+h.fontName,n.textBaseline="top",u=i.heightVirtualToScreen(this.height),e(n,this.text,f.x,f.y,u,s*u)}}function s(n,i,r,u,f,e,o,s,h){var c;this.base=t,this.base(n,i,r,f,e,o,s),this.onload=h,this.isLoading=!0,c=new Image,this.img=c,this.img.isLoaded=!1;var l=this,a=function(){var i,n,r,u,t;c.isLoading=!1,c.isRemoved?(delete c.isRemoved,delete c.isLoaded):(c.naturalHeight&&(i=l.width/l.height,n=c.naturalWidth/c.naturalHeight,i>n?(r=n*l.height,t=(l.width-r)/2,l.x+=t,l.width=r):i<n&&(u=l.width/n,t=(l.height-u)/2,l.y+=t,l.height=u)),c.isLoaded=!0,l.onLoad&&l.onLoad(),l.vc.requestInvalidate())},v=function(){if(c.isFallback)throw"Cannot load an image!";else c.isFallback=!0,c.src=fallbackImageUri};this.img.addEventListener("load",a,!1),h&&this.img.addEventListener("load",h,!1),this.img.addEventListener("error",v,!1),this.img.src=u,this.render=function(n,t,i,r,u){if(this.img.isLoaded){var f=i.pointVirtualToScreen(this.x,this.y);n.globalAlpha=u,n.drawImage(this.img,f.x,f.y,r.x,r.y)}},this.onRemove=function(){this.img.removeEventListener("load",a,!1),this.img.removeEventListener("error",v,!1),this.onload&&this.img.removeEventListener("load",this.onload,!1),this.img.isRemoved=!0,delete this.img}}function et(n,t,i,r,f,e,o,h,c){this.base=u,this.base(n,t,i,f,e,o,h),this.imageSources=r,this.changeZoomLevel=function(r,u){var l=this.imageSources.length;if(l==0)return null;for(;--l>=0;)if(this.imageSources[l].zoomLevel<=u)return this.imageSources[l].zoomLevel===r?null:{zoomLevel:this.imageSources[l].zoomLevel,content:new s(n,t,i+"@"+this.imageSources[l].zoomLevel,this.imageSources[l].imageSource,f,e,o,h,c)};return null}}function r(n,i,r,u,f,e,o,s){this.base=t,this.base(n,i,r,u,f,e,o),this.initializeContent=function(n){this.content=n,n&&(n.style.position="absolute",n.style.overflow="hidden",n.style.zIndex=s)},this.onIsRenderedChanged=function(){this.content&&(this.isRendered?(this.content.isAdded||(this.vc.element[0].appendChild(this.content),this.content.isAdded=!0),this.content.style.display="block"):this.content.style.display="none")},this.render=function(n,t,i,r,u){if(this.content){var f=i.pointVirtualToScreen(this.x,this.y),w=i.height,b=i.width,a=0,v=0,y=r.y,p=r.x,s=0,h=w,c=f.y,l=f.y+r.y,e=Math.max(s,c),o=Math.min(h,l);e<=o&&(a=e-f.y,y=o-f.y),s=0,h=b,c=f.x,l=f.x+r.x,e=Math.max(s,c),o=Math.min(h,l),e<=o&&(v=e-f.x,p=o-f.x),this.content.style.left=f.x+"px",this.content.style.top=f.y+"px",this.content.style.width=r.x+"px",this.content.style.height=r.y+"px",this.content.style.clip="rect("+a+"px,"+p+"px,"+y+"px,"+v+"px)",this.content.style.opacity=u,this.content.style.filter="alpha(opacity="+u*100+")"}},this.onRemove=function(){if(this.content)try{this.content.isAdded&&(this.content.src&&(this.content.src=""),this.vc.element[0].removeChild(this.content),this.content.isAdded=!1)}catch(n){alert(n.Description)}}}function v(n,t,i,u,f,e,o,s,h){var c,l;this.base=r,this.base(n,t,i,u,f,e,o,h),c=$("<div id='citext_"+i+"' class='contentItemDescription'><\/div").appendTo(n),c[0].addEventListener("mousemove",preventbubble,!1),c[0].addEventListener("mousedown",preventbubble,!1),c[0].addEventListener("DOMMouseScroll",preventbubble,!1),c[0].addEventListener("mousewheel",preventbubble,!1),l=$("<div style='position:relative' class='text'><\/div>").html(s).appendTo(c),this.initializeContent(c[0]),this.render=function(n,t,i,r,u){var f=r.y/contentItemDescriptionNumberOfLines;c.css("font-size",f+"px"),v.prototype.render.call(this,n,t,i,r,u)},this.onRemove=function(){v.prototype.onRemove.call(this),c[0].removeEventListener("mousemove",preventbubble,!1),c[0].removeEventListener("mouseup",preventbubble,!1),c[0].removeEventListener("mousedown",preventbubble,!1),c[0].removeEventListener("DOMMouseScroll",preventbubble,!1),c[0].removeEventListener("mousewheel",preventbubble,!1),c=undefined}}function ot(n,t,i,u,f,e,o,s,h){this.base=r,this.base(n,t,i,f,e,o,s,h);var c=document.createElement("iframe");c.setAttribute("id",i),u+=u.indexOf("?")==-1?"?wmode=opaque":"&wmode=opaque",c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function st(n,t,i,u,f,e,o,s,h){this.base=r,this.base(n,t,i,f,e,o,s,h);var c=document.createElement("iframe");c.setAttribute("id",i),u+=u.indexOf("?")==-1?"?wmode=opaque":"&wmode=opaque",c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function ht(n,t,i,u,f,e,o,s,h){this.base=r,this.base(n,t,i,f,e,o,s,h);var c=document.createElement("audio");c.setAttribute("id",i),c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function y(n,t,i,u,f,o,s,h,c,l,a){var v=this,p;this.base=r,this.base(n,i,u,o,s,h,c,l),this.onload=a,this.nAttempts=0,this.timeoutHandles=[],p=document.createElement("div"),p.setAttribute("id",u),p.setAttribute("style","color: white"),this.initializeContent(p),this.viewer=new Seadragon.Viewer(p),this.viewer.elmt.addEventListener("mousemove",preventbubble,!1),this.viewer.elmt.addEventListener("mousedown",preventbubble,!1),this.viewer.elmt.addEventListener("DOMMouseScroll",preventbubble,!1),this.viewer.elmt.addEventListener("mousewheel",preventbubble,!1),this.viewer.addEventListener("open",function(){v.onload&&v.onload(),v.vc.requestInvalidate()}),this.viewer.addEventListener("resize",function(n){v.viewer.setDashboardEnabled(n.elmt.clientWidth>250)}),this.onSuccess=function(n){var t,i;if(n.error){v.showFallbackImage();return}if(t=n.content,t.ready){for(i=0;i<v.timeoutHandles.length;i++)clearTimeout(v.timeoutHandles[i]);v.viewer.openDzi(t.dzi)}else t.failed?v.showFallbackImage():v.nAttempts<seadragonMaxConnectionAttempts?(v.viewer.showMessage("Loading "+Math.round(100*t.progress)+"% done."),v.timeoutHandles.push(setTimeout(v.requestDZI,seadragonRetryInterval))):v.showFallbackImage()},this.onError=function(){v.nAttempts<seadragonMaxConnectionAttempts?v.timeoutHandles.push(setTimeout(v.requestDZI,seadragonRetryInterval)):v.showFallbackImage()},this.requestDZI=function(){v.nAttempts++,$.ajax({url:seadragonServiceURL+encodeURIComponent(f),dataType:"jsonp",success:v.onSuccess,error:v.onError})},this.render=function(n,t,i,r,u){v.viewer.isFullPage()||(y.prototype.render.call(this,n,t,i,r,u),v.viewer.viewport&&(v.viewer.viewport.resize({x:r.x,y:r.y}),v.viewer.viewport.update()))},this.onRemove=function(){v.viewer.close(),y.prototype.onRemove.call(this)},this.showFallbackImage=function(){for(var n=0;n<v.timeoutHandles.length;n++)clearTimeout(v.timeoutHandles[n]);v.onRemove(),e(t,v.id),lt(t,i,u,o,s,h,c,f)},v.requestDZI()}function gt(n,t,r,u){var f=u.timeEnd-u.timeStart;return i(n,new it(n.vc,t,r,u.timeStart,u.top,f,u.height,{strokeStyle:u.strokeStyle?u.strokeStyle:timelineStrokeStyle,lineWidth:timelineLineWidth,fillStyle:u.fillStyle},u),!0)}function h(n,t,i,r,e,h,l,a){this.base=u,this.base(n,t,i,r,e,h,l),this.type="contentItem";var k=l*contentItemTopTitleHeight*.8,p=l*contentItemMediaHeight,rt=contentItemFontHeight*l,v=h*contentItemContentWidth,y=(h-v)/2,b=l*contentItemVerticalMargin,w=e+b,nt=b*.4,tt=w+p+nt,ut=r+h-y,d=l*contentItemSourceHeight*.8,g=tt+b+d,it=ct(this,t,i+"__rect__",r,e,h,l,{strokeStyle:contentItemBoundingBoxBorderColor,lineWidth:contentItemBoundingBoxBorderWidth*h,fillStyle:contentItemBoundingBoxFillColor,isLineWidthVirtual:!0});this.reactsOnMouse=!0,this.onmouseenter=function(){it.settings.strokeStyle=contentItemBoundingHoveredBoxBorderColor,this.vc.currentlyHoveredContentItem=this,this.vc.requestInvalidate()},this.onmouseleave=function(){it.settings.strokeStyle=contentItemBoundingBoxBorderColor,this.vc.currentlyHoveredContentItem=null,this.isMouseIn=!1,this.vc.requestInvalidate()},this.onmouseclick=function(n){return c(this,n,1)},this.changeZoomLevel=function(u,c){var ht,ot,st,ct,ut,lt,bt;if(c>=contentItemShowContentZoomLevel){if(u>=contentItemShowContentZoomLevel)return null;var it=new o(n,t,i+"__content",r,e,h,l),ft=i+"__media__",et=null;return a.mediaType==="image"?et=at(it,t,ft,r+y,w,v,p,mediaContentElementZIndex,a.mediaUrl):a.mediaType==="video"?vt(it,t,ft,a.mediaUrl,r+y,w,v,p,mediaContentElementZIndex):a.mediaType==="audio"?(w+=contentItemAudioTopMargin*l,p=l*contentItemAudioHeight,pt(it,t,ft,a.mediaUrl,r+y,w,v,p,mediaContentElementZIndex)):a.mediaType==="pdf"&&yt(it,t,ft,a.mediaUrl,r+y,w,v,p,mediaContentElementZIndex),ht=a.title,f(it,t,i+"__title__",r+y,g,g+k/2,.9*k,ht,{fontName:contentItemHeaderFontName,fillStyle:contentItemHeaderFontColor,textBaseline:"middle",textAlign:"center",wrapText:!0,numberOfLines:1},v),ot=a.attribution,ot&&(st=function(r,u,e){var o=f(it,t,i+"__source__",r,e,e+d/2,.9*d,ot,{fontName:contentItemHeaderFontName,fillStyle:contentItemSourceFontColor,textBaseline:"middle",textAlign:"right",adjustWidth:!0},u);a.mediaSource&&(o.reactsOnMouse=!0,o.onmouseclick=function(){return n.element.css("cursor","default"),window.open(a.mediaSource),!0},o.onmouseenter=function(){this.settings.fillStyle=contentItemSourceHoveredFontColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","pointer")},o.onmouseleave=function(){this.settings.fillStyle=contentItemSourceFontColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","default")})},et?et.onLoad=function(){var n=this.x,t=this.width,i=this.y+this.height+nt;st(n,t,i),this.onLoad=null}:st(r+y,v,tt)),ct=g+k+b,wt(it,t,i+"__description__",r+y,ct,v,rt,a.description,30,{}),{zoomLevel:contentItemShowContentZoomLevel,content:it}}if(ut=c,ut>=contentItemThumbnailMaxLevel){if(u>=contentItemThumbnailMaxLevel&&u<contentItemShowContentZoomLevel)return null;ut=contentItemThumbnailMaxLevel}else if(ut<=contentItemThumbnailMinLevel){if(u<=contentItemThumbnailMinLevel&&u>0)return null;ut=contentItemThumbnailMinLevel}return lt=1<<ut,bt=contentItemThumbnailBaseUri+"x"+lt+"/"+a.guid+".png",{zoomLevel:c,content:new s(n,t,i+"@1",bt,r,e,h,l)}}}function b(n,t,r,e,h,l,v,y){var w;this.base=a,this.base(n,t,r,e,h,l,{strokeStyle:infoDotBorderColor,lineWidth:infoDotBorderWidth*l,fillStyle:infoDotFillColor,isLineWidthVirtual:!0}),this.contentItems=v,this.hasContentItems=!1,v.sort(function(n,t){return n.order-t.order}),w=l-infoDotHoveredBorderWidth*l,this.outerRad=l,this.type="infodot",this.reactsOnMouse=!0,this.tooltipEnabled=!0,this.tooltipIsShown=!1,this.onmouseenter=function(){this.settings.strokeStyle=infoDotHoveredBorderColor,this.settings.lineWidth=infoDotHoveredBorderWidth*l,this.vc.requestInvalidate(),this.vc.currentlyHoveredTimeline!=null&&(stopAnimationTooltip(),this.vc.currentlyHoveredTimeline.tooltipIsShown=!1),$(".bubbleInfo span").text(y.title),this.panelWidth=$(".bubbleInfo").outerWidth(),this.panelHeight=$(".bubbleInfo").outerHeight(),tooltipMode="infodot",this.tooltipEnabled==!0&&this.tooltipIsShown==!1&&(this.tooltipIsShown=!0,$(".bubbleInfo").attr("id","defaultBox"),animationTooltipRunning=$(".bubbleInfo").fadeIn()),this.vc.cursorPosition=e,this.vc.currentlyHoveredInfodot=this,this.vc._setConstraintsByInfodotHover(this),this.vc.RaiseCursorChanged()},this.onmouseleave=function(){this.isMouseIn=!1,this.settings.strokeStyle=infoDotBorderColor,this.settings.lineWidth=infoDotBorderWidth*l,this.vc.requestInvalidate(),this.tooltipIsShown==!0&&stopAnimationTooltip(),this.tooltipIsShown=!1,tooltipMode="default",this.vc.currentlyHoveredInfodot=undefined,this.vc._setConstraintsByInfodotHover(undefined),this.vc.RaiseCursorChanged()},this.onmouseclick=function(n){return c(this,n,1)};var nt=!0,p=this,d=new u(n,t,r+"_dlod",e-w,h-w,2*w,2*w);d.removeWhenInvisible=!0,i(this,d,!1),d.firstLoad=!0,d.changeZoomLevel=function(u,c){var rt,a,v,b,et,g;if(c>=infodotShowContentThumbZoomLevel&&c<infodotShowContentZoomLevel){if(rt=getURL(),typeof rt.hash.params!="undefined"&&typeof rt.hash.params.b!="undefined"&&(nt=!1),u>=infodotShowContentThumbZoomLevel&&u<infodotShowContentZoomLevel)return null;if(p.tooltipEnabled=!0,a=null,p.contentItems.length>0&&(a=new o(n,t,r+"__contentItems",d.x,d.y,2*w,2*w),v=k(p.contentItems,e,h,w,n,t),v))for(b=0;b<v.length;b++)i(a,v[b],!1);return a?(p.hasContentItems=!0,{zoomLevel:c,content:a}):null}if(c>=infodotShowContentZoomLevel){if(u>=infodotShowContentZoomLevel)return null;if(p.tooltipEnabled=!1,p.tooltipIsShown==!0&&(stopAnimationTooltip(),p.tooltipIsShown=!1),a=null,p.contentItems.length>0&&(a=new o(n,t,r+"__contentItems",d.x,d.y,2*w,2*w),v=k(p.contentItems,e,h,w,n,t),v))for(b=0;b<v.length;b++)i(a,v[b],!1);if(a==null)return null;var ut=infodotTitleWidth*l*2,ot=infodotTitleHeight*l*2,st=140/225*l,ht=h-st-ot,ct="";y&&y.title&&y.date&&(ct=y.title+"\n("+y.date+")"),f(a,t,r+"__title",e-ut/2,ht,ht,ot,ct,{fontName:contentItemHeaderFontName,fillStyle:contentItemHeaderFontColor,textBaseline:"middle",textAlign:"center",wrapText:!0,numberOfLines:2},ut);var lt=h+st+63/225*l,ft=infodotBibliographyHeight*l*2,at=ut/3,tt=f(a,t,r+"__bibliography",e-at/2,lt-ft,lt-ft/2,ft,"Bibliography",{fontName:contentItemHeaderFontName,fillStyle:timelineBorderColor,textBaseline:"middle",textAlign:"center"},at);if(tt.reactsOnMouse=!0,tt.onmouseclick=function(){return this.vc.element.css("cursor","default"),showBibliography({infodot:y,contentItems:p.contentItems},a,r+"__bibliography"),!0},tt.onmouseenter=function(){this.settings.fillStyle=infoDotHoveredBorderColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","pointer")},tt.onmouseleave=function(){this.settings.fillStyle=infoDotBorderColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","default")},et=window.location.hash.match("b=([a-z0-9_]+)"),et&&nt&&showBibliography({infodot:y,contentItems:p.contentItems},a,et[1]),a)return p.hasContentItems=!0,{zoomLevel:c,content:a}}else{if((p.tooltipEnabled=!0,p.hasContentItems=!1,p.contentItems.length==0)||(g=c,g<=contentItemThumbnailMinLevel&&u<=contentItemThumbnailMinLevel&&u>0))return null;if(g>=contentItemThumbnailMaxLevel){if(u>=contentItemThumbnailMaxLevel&&u<infodotShowContentZoomLevel)return null;g=contentItemThumbnailMaxLevel}if(g<contentItemThumbnailMinLevel)return{zoomLevel:g,content:new o(n,t,r+"__empty",e,h,0,0)};var a=p.contentItems[0],vt=1<<g,yt=contentItemThumbnailBaseUri+"x"+vt+"/"+a.guid+".png",it=w*260/225;return{zoomLevel:g,content:new s(n,t,r+"@"+g,yt,e-it/2,h-it/2,it,it)}}};var g=1/225,tt=252*g,it=262*g,rt=3*g*l,ut=24*g*l,ft=-tt/2*l+e,et=-it/2*l+h,ot=tt/2*l+e,st=it/2*l+h;this.render=function(n,t,i,r,u){var s;if(b.prototype.render.call(this,n,t,i,r,u),s=i.widthVirtualToScreen(rt),!(s<.5)){var h=this.width/2,c=this.x+h,l=this.y+h,a=r.x/2,f=i.widthVirtualToScreen(ut),e=i.pointVirtualToScreen(ft,et),o=i.pointVirtualToScreen(ot,st);n.lineWidth=s,n.strokeStyle=contentItemBoundingBoxFillColor,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(e.x-f,e.y-f),n.stroke(),n.beginPath(),n.moveTo(o.x,o.y),n.lineTo(o.x+f,o.y+f),n.stroke(),n.beginPath(),n.moveTo(e.x,o.y),n.lineTo(e.x-f,o.y+f),n.stroke(),n.beginPath(),n.moveTo(o.x,e.y),n.lineTo(o.x+f,e.y-f),n.stroke()}}}function ni(n,t){var i;if(n.type!=="infodot"||n.contentItems.length===0)return null;var u=n.width/2,f=u-infoDotHoveredBorderWidth*u,r=k(n.contentItems,n.x+n.width/2,n.y+n.height/2,f,n.vc,n.layerid);if(!r)return null;for(i=0;i<r.length;i++)if(r[i].id==t)return{x:r[i].x,y:r[i].y,width:r[i].width,height:r[i].height,parent:n};return null}function ti(n,t,r,u,f,e,o,s){var h=new b(n.vc,t,r,u,f,e,o,s);return i(n,h,!0)}function k(n,t,i,r,u,f){var p=n.length,et,ot,e,o;if(p<=0)return null;p--;var c=[],l=1/225,w=260*l,b=270*l,it=-w/2-38*l,st=-it,a=60*l,v=a,k=a*r,g=v*r,ht=-b/2-9*l-v/2,ct=-ht;c.push(new h(u,f,n[0].id,-w/2*r+t,-b/2*r+i,w*r,b*r,n[0]));var nt=Math.floor(p/3),tt=p%3,rt=nt+(tt>0?1:0),ut=nt+(tt>1?1:0),ft=nt+(tt>2?1:0),s=1,y=d(rt,v),lt=t+r*(it-a/2);for(e=0;e<rt;e++,s++)o=n[s],c.push(new h(u,f,o.id,lt,i+r*y[e],k,g,o));for(y=d(ft,a),et=i+r*(ct-v/2),e=0;e<ft;e++,s++)o=n[s],c.push(new h(u,f,o.id,t+r*y[e],et,k,g,o));for(y=d(ut,v),ot=t+r*(st-a/2),e=ut;--e>=0;s++)o=n[s],c.push(new h(u,f,o.id,ot,i+r*y[e],k,g,o));return c}function d(n,t){if(n==0)return null;var r=.05*t,i,u,f,e;return n%2==0?(i=-r/2-t,u=r/2,n==4)?(f=i-t-r,e=u+r+t,[f,i,u,e]):[i,u]:(i=-t/2,n>1)?(u=t/2+r,f=i-t-r,[f,i,u]):[i]}var p=$.Event("elementclick"),c;n.getVisibleForElement=g,c=function(n,t,i){var r=n.vc.getViewport(),u=g(n,i,r);return p.newvisible=u,p.element=n,n.vc.element.trigger(p),!0};var ct=function(n,t,r,u,f,e,o,s){return i(n,new l(n.vc,t,r,u,f,e,o,s),!1)},ii=function(n,t,r,u,f,e,o,s){return i(n,new a(n.vc,t,r,u,f,e,o),s)},lt=function(n,t,r,u,f,e,o,h,c){if(e<=0||o<=0)throw"Image size must be positive";return i(n,new s(n.vc,t,r,h,u,f,e,o,c),!1)},ri=function(n,t,r,u,f,e,o,s,h){if(e<=0||o<=0)throw"Image size must be positive";return i(n,new et(n.vc,t,r,s,u,f,e,o,h),!1)},at=function(n,t,r,u,f,e,o,s,h,c){if(e<=0||o<=0)throw"Image size must be positive";return i(n,new y(n.vc,n,t,r,h,u,f,e,o,s,c),!1)},vt=function(n,t,r,u,f,e,o,s,h){return i(n,new st(n.vc,t,r,u,f,e,o,s,h),!1)},yt=function(n,t,r,u,f,e,o,s,h){return i(n,new ot(n.vc,t,r,u,f,e,o,s,h),!1)},pt=function(n,t,r,u,f,e,o,s,h){return i(n,new ht(n.vc,t,r,u,f,e,o,s,h),!1)};var nt=function(n,t,i,r,u){var f,s,o,h,e;if(!n.isVisible(i)){n.isRendered&&w(n);return}if(f=r.vectorVirtualToScreen(n.width,n.height),f.y<=renderThreshold||n.width!=0&&f.x<=renderThreshold){n.isRendered&&w(n);return}for(s=t[n.layerid],n.opacity!=null&&(u*=n.opacity),n.isRendered!=undefined&&n.isRendered||(n.isRendered=!0,n.onIsRenderedChanged&&n.onIsRenderedChanged()),n.render(s,i,r,f,u),o=n.children,h=o.length,e=0;e<h;e++)nt(o[e],t,i,r,u)},i=function(n,t,i){var r=n.width==Infinity||t.x>=n.x&&t.x+t.width<=n.x+n.width&&t.y>=n.y&&t.y+t.height<=n.y+n.height;if(!r&&Log&&Log.push("Child element does not belong to the parent element "+n.id+" "+t.ID),!i&&!r)throw"Child element does not belong to the parent element";return n.children.push(t),t.parent=n,t},e=function(n,t){for(var u=n.children.length,i,r=0;r<u;r++)if(i=n.children[r],i.id==t)return n.children.splice(r,1),tt(i),i.onRemove&&i.onRemove(),i.parent=null,!0;return!1};n.getChild=bt,kt.prototype=t,u.prototype=t,o.prototype=t,l.prototype=t,it.prototype=l,a.prototype=t,ut.prototype=t,ft.prototype=t,s.prototype=t,et.prototype=u,r.prototype=t,v.prototype=r,ot.prototype=r,st.prototype=r,ht.prototype=r,y.prototype=r,n.addTimeline=gt,h.prototype=u,b.prototype=a,n.getContentItem=ni,n.addInfodot=ti})(n.VCContent||(n.VCContent={}));var t=n.VCContent})(ChronoZoom||(ChronoZoom={}))