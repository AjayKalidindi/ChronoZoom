var ChronoZoom;(function(n){(function(){var t=n.Settings;$.widget("ui.axis",{width:null,height:null,beta:0,delta:1,regime:"",level:1,ticks:null,minorTicks:null,labels:null,mousePosition:null,log10:1/Math.log(10),firstYear:null,startDate:null,endDate:null,markerPosition:-1,doesMarkerMovesOnHover:!0,numberOfThresholds:null,thresholds:null,thresholdVisibility:"no",currentThreshold:-1,showThresholds:null,animation:!1,hideAllTimeout:undefined,highlighted_num:0,_create:function(){var n,i;this.backgroundCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("backgroundCanvas"),this.ticksCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("ticksCanvas"),this.mouseMarkCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("mouseMarkCanvas"),this.thresholdCanvas=$("<canvas><\/canvas>").appendTo(this.element).addClass("thresholdCanvas"),n=this.backgroundCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.ticksCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.mouseMarkCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,n=this.thresholdCanvas[0],n.width=this.element[0].clientWidth,n.height=this.element[0].clientHeight,this.width=n.width,this.height=n.height,t.czVersion=="mobile"?this.showThresholds=!1:t.czVersion=="main"&&(this.showThresholds=!0),this._loadThresholds(),this.thresholds!=null&&this._setThresholdsVisibility(),i=this,i.element.mouseup(function(n){switch(n.which){case 1:i._mouseUp(n)}}),i.element.mousemove(function(n){i._mouseMove(n)}),i.element.mouseleave(function(){i._mouseLeave()}),this._drawBackground(),this.setRange(t.maxPermitedTimeRange.left,t.maxPermitedTimeRange.right)},allowMarkerMovesOnHover:function(n){this.doesMarkerMovesOnHover=n},_init:function(){},_destroy:function(){return this.backgroundCanvas.remove(),this.ticksCanvas.remove(),this.mouseMarkCanvas.remove(),this.thresholdCanvas.remove(),this.element.removeClass("axis"),this},_loadThresholds:function(){var n,i=this;switch(t.czDataSource){case"db":n="Chronozoom.svc/getthresholds";break;case"relay":n="ChronozoomRelay";break;case"dump":n="ResponseDumpThresholds.txt"}$.ajax({cache:!1,type:"GET",async:!0,dataType:"json",url:n,success:function(n){i._getThresholdsContent(n)},error:function(n){alert("Error connecting to service: "+n.responseText)}})},_getThresholdsContent:function(i){this.numberOfThresholds=i.d.length,this.thresholds=[];for(var r=0;r<this.numberOfThresholds;r++)i.d[r].time=n.Common.getCoordinateFromDecimalYear(i.d[r].ThresholdYear),this.thresholds[r]={title:i.d[r].Title,description:i.d[r].Description==null?"":i.d[r].Description,time:i.d[r].time,bookmark:i.d[r].BookmarkRelativePath,color:t.thresholdColors[r%t.thresholdColors.length],textColor:t.thresholdTextColors[r%t.thresholdTextColors.length],isVisible:!1,showing:"left",coordinate:0}},_mouseUp:function(i){var h,c,l,r,u,o;if(this.showThresholds){if(this.doesMarkerMovesOnHover){var u=n.Common.getXBrowserMouseOrigin(this.element,i),a=(this.options.range.right-this.options.range.left)/this.width,v=this.options.range.right-a*(this.width-u.x);this.setTimeMarker(v)}var f=0,y=t.axisHeight-t.gapLabelTick,e=this,p=this.element[0].offsetTop+y,s=!1;if(this.thresholds&&(h=this.thresholdCanvas[0],c=h.getContext("2d"),c.font=t.axisTextSize-1+" "+t.axisTextFont,l=!1,this.thresholds!=null))for(r=0;r<this.thresholds.length;r++)this.thresholds[r].isVisible&&(f=this.thresholds[r].coordinate,u=n.Common.getXBrowserMouseOrigin(this.element,i),u.x>=f-2&&u.x<=f+10&&u.y>=t.axisHeight-t.strokeWidth-10&&u.y<=t.axisHeight-t.strokeWidth+0&&s!=!0&&(o=0,this.thresholdVisibility=="no"&&(o=1,$("div").is("#threshold"+r)||e._onExpandThreshold(r)),this.thresholdVisibility=="one"&&o==0&&(e._onThresholdsClear(!1),this.thresholdVisibility="no",$("div").is("#threshold"+r)||e._onExpandThreshold(r)),s=!0,l&&(this.thresholdVisibility="one")))}},_mouseMove:function(i){var u,f,o,a;if(this.doesMarkerMovesOnHover){var r=n.Common.getXBrowserMouseOrigin(this.element,i),v=(this.options.range.right-this.options.range.left)/this.width,y=this.options.range.right-v*(this.width-r.x);this.setTimeMarker(y)}var s=!1,h=2,c=10,e=10,l=this;if(this.thresholds!=null)for(u=0;u<this.thresholds.length;u++)f=this.thresholds[u].coordinate,r.x>=f-h&&r.x<=f+c&&r.y>=t.axisHeight-t.strokeWidth-e&&r.y<=t.axisHeight-t.strokeWidth+e&&s!=!0?(this.highlighted_num=u,s=!0,o=this.mouseMarkCanvas[0],a=o.getContext("2d"),a.clearRect(0,0,o.width,o.height),l._drawHighlightedCollapsedThreshold(u)):r.x>=f-10*h&&r.x<=f+2*c&&r.y>=t.axisHeight-t.strokeWidth-2*e&&r.y<=t.axisHeight-t.strokeWidth+2*e&&l._drawCollapsedThreshold(u)},_mouseLeave:function(){var t=this,n;if(this.thresholds!=null)for(n=0;n<this.thresholds.length;n++)t._drawCollapsedThreshold(n)},_showThreshold:function(n){var t=this;$("#threshold"+n).show("slide",{direction:this.thresholds[n].showing},"slow"),this.animation=!1},_hideThresholdCompleted:function(n){var i=this;$("#line"+n).slideUp(t.thresholdsAnimationTime,function(){i._hideLineCompleted(n)}),$("#threshold"+n).remove()},_hideLineCompleted:function(n){$("#line"+n).remove(),this._onThresholdsClearCompleted()},_hideThresholdsCompleted:function(n,i){var r=this;$("#line"+n).slideUp(t.thresholdsAnimationTime,function(){var n=parseFloat(this.id.substring(4));r._hideLinesCompleted(n,i)}),$("#threshold"+n).remove()},_hideThresholdsCompletedSpecific:function(n,i){var r=this;$("#line"+n).slideUp(t.thresholdsAnimationTime,function(){var n=parseFloat(this.id.substring(4));r._hideLinesCompletedSpecific(n,i)}),$("#threshold"+n).remove()},_hideLinesCompleted:function(n,t){$("#line"+n).remove(),t||this._onThresholdsClearCompleted()},_hideLinesCompletedSpecific:function(n){$("#line"+n).remove()},enableThresholds:function(n){!n&&this.showThresholds&&this._onThresholdsClear(!1),this.showThresholds=n},_onExpandThreshold:function(n){var i=this,u=this.element[0].offsetTop+t.axisHeight-t.gapLabelTick,r=this.thresholds[n].coordinate;this.currentThreshold=n,$('<div id="line'+n+'">').appendTo(this.element).addClass("thresholdLine").css({width:t.thresholdWidth,left:this.element[0].offsetLeft+r,top:u,"background-color":this.thresholds[n].color,height:t.thresholdHeight}),$('<div id="threshold'+n+'" style="color:'+this.thresholds[n].textColor+'"><div style="left: 5px; top: 5px; position: absolute">Threshold '+(n+1)+':<\/div><div id="title" style="left: 15px; top: 17px; position: absolute; color: White;">'+this.thresholds[n].title+'<\/div><div id="desc" style="left: 10px; right: 10px; position: absolute">'+this.thresholds[n].description+'<\/div><div id="bookmark" style="right: 13px; bottom: 25px; position: absolute; color: White; cursor: pointer;">Jump To Threshold -> <\/div><div id="bookmark2" style="right: 13px; bottom: 8px; position: absolute; color: White; cursor: pointer;">Close Threshold <\/div><\/div>').appendTo(this.element).addClass("thresholdDiv").css({"background-color":this.thresholds[n].color,top:u+t.thresholdHeight,left:this.element[0].offsetLeft+r}),$("#threshold"+n+" #desc").css("top",$("#threshold"+n+" #title").height()+22),$("#threshold"+n).css("height",$("#threshold"+n+" #desc").height()+96),$("#threshold"+n).position().left+$("#threshold"+n).width()>=this.width-450?(this.thresholds[n].showing="right",$("#threshold"+n).css("left",this.element[0].offsetLeft+r-$("#threshold"+n).width()+t.thresholdWidth)):this.thresholds[n].showing="left",$("#threshold"+n+" #bookmark")[0].addEventListener("mouseup",function(){i.currentThreshold!=-1&&i._onThresholdMouseClick()},!1),$("#threshold"+n+" #bookmark2")[0].addEventListener("mouseup",function(){i.currentThreshold!=-1&&i._onThresholdsClear(!1)},!1),$("#threshold"+n)[0].addEventListener("mousemove",function(){var n=window.event;n&&preventbubble(n),i.setTimeMarker(i.thresholds[i.currentThreshold].time),i.currentThreshold!=-1&&i.setTimeMarker(i.thresholds[i.currentThreshold].time)},!1),$("#threshold"+n).show("slide",{direction:this.thresholds[n].showing},"slow"),i.thresholdVisibility="one"},_onThresholdsClear:function(n){var r=this,i;if(this.thresholdVisibility=="one")for(i=0;i<this.thresholds.length;i++)this.thresholds[i].isVisible&&(this.animation?($("#threshold"+i).remove(),$("#line"+i).remove(),this._onThresholdsClearCompleted()):$("#threshold"+i).slideUp(t.thresholdsAnimationTime,function(){var t=parseFloat(this.id.substring(9));r._hideThresholdsCompletedSpecific(t,n)}))},_onThresholdsClearCompleted:function(){this.currentThreshold=-1,this.thresholdVisibility="no";var n=this.thresholdCanvas[0],t=n.getContext("2d");t.clearRect(0,0,n.width,n.height)},_onThresholdMouseClick:function(){var t=window.event,n=new $.Event("thresholdBookmarkChanged");n.Bookmark=this.thresholds[this.currentThreshold].bookmark,this.element.trigger(n),this._onThresholdsClear(!1)},_drawBackground:function(){var i=this.backgroundCanvas[0],n=i.getContext("2d"),r;n.clearRect(0,0,i.width,i.height),n.strokeStyle=t.axisStrokeColor,n.lineWidth=t.strokeWidth,r=t.axisHeight-t.strokeWidth,n.beginPath(),n.moveTo(0,r),n.lineTo(this.width,r),n.closePath(),n.stroke()},_drawCollapsedThresholds:function(){var t=this,n;if(this.thresholds!=null&&this.showThresholds!=!1)for(n=0;n<this.thresholds.length;n++)t._drawCollapsedThreshold(n)},_drawCollapsedThreshold:function(n){var u=this.ticksCanvas[0],i=u.getContext("2d"),r;this.thresholds!=null&&this.showThresholds!=!1&&this.thresholds[n].isVisible&&(r=this.thresholds[n].coordinate,i.fillStyle=this.thresholds[n].color,i.strokeStyle="black",i.beginPath(),i.moveTo(r,t.axisHeight-t.strokeWidth),i.lineTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth),i.lineTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth-(t.thresholdHeight-t.rectangleRadius)),i.quadraticCurveTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth-t.thresholdHeight,r+t.thresholdWidth-t.rectangleRadius,t.axisHeight-t.strokeWidth-t.thresholdHeight),i.lineTo(r+t.rectangleRadius,t.axisHeight-t.strokeWidth-t.thresholdHeight),i.quadraticCurveTo(r,t.axisHeight-t.strokeWidth-t.thresholdHeight,r,t.axisHeight-t.strokeWidth-(t.thresholdHeight-t.rectangleRadius)),i.lineTo(r,t.axisHeight-t.strokeWidth),i.closePath(),i.lineWidth=1,i.fill(),i.lineWidth=2,i.stroke())},_drawHighlightedCollapsedThreshold:function(n){var u=this.ticksCanvas[0],i=u.getContext("2d"),r;this.thresholds!=null&&this.showThresholds!=!1&&this.thresholds[n].isVisible&&(r=this.thresholds[n].coordinate,i.fillStyle=this.thresholds[n].color,i.strokeStyle="white",i.lineWidth=1,i.beginPath(),i.moveTo(r,t.axisHeight-t.strokeWidth),i.lineTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth),i.lineTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth-(t.thresholdHeight-t.rectangleRadius)),i.quadraticCurveTo(r+t.thresholdWidth,t.axisHeight-t.strokeWidth-t.thresholdHeight,r+t.thresholdWidth-t.rectangleRadius,t.axisHeight-t.strokeWidth-t.thresholdHeight),i.lineTo(r+t.rectangleRadius,t.axisHeight-t.strokeWidth-t.thresholdHeight),i.quadraticCurveTo(r,t.axisHeight-t.strokeWidth-t.thresholdHeight,r,t.axisHeight-t.strokeWidth-(t.thresholdHeight-t.rectangleRadius)),i.lineTo(r,t.axisHeight-t.strokeWidth),i.closePath(),i.fill(),i.stroke())},_drawNotCollapsedThresholds:function(){var u=this.ticksCanvas[0],f=u.getContext("2d"),n,r,i;if(f.lineWidth=2,this.thresholds!=null)for(n=0;n<this.thresholds.length;n++)this.thresholds[n].isVisible?$("div").is("#threshold"+n)&&(r=this.thresholds[n].coordinate,$("#line"+n).css("left",this.element[0].offsetLeft+r),this.thresholds[n].showing=="right"?$("#threshold"+n).position().left>=0&&$("#threshold"+n).position().left+$("#threshold"+n).width()<=this.width+5?$("#threshold"+n).css("left",this.element[0].offsetLeft+r-$("#threshold"+n).width()+t.thresholdWidth):(i=this,$("#threshold"+n).remove(),$("#line"+n).remove(),i._hideThresholdsCompleted(n,!1)):$("#threshold"+n).position().left+$("#threshold"+n).width()<=this.width-7?$("#threshold"+n).css("left",this.element[0].offsetLeft+r):(i=this,$("#threshold"+n).remove(),$("#line"+n).remove(),i._hideThresholdsCompleted(n,!1))):$("div").is("#threshold"+n)&&(i=this,$("#threshold"+n).remove(),$("#line"+n).remove(),i._hideThresholdsCompleted(n,!1))},_drawTicks:function(){var c=this.ticksCanvas[0],n=c.getContext("2d"),r,f,l,e,u;n.clearRect(0,0,c.width,c.height),n.strokeStyle=t.axisStrokeColor,n.font=t.axisTextSize+" "+t.axisTextFont,n.lineWidth=1,r="",r=this.regime=="Ga"?"Billions of Years Ago":this.regime=="Ma"?"Millions of Years Ago":this.regime=="ka"?"Thousands of Years Ago":this.regime,n.strokeText(r,t.horizontalTextMargin,t.verticalTextMargin),this.options.mode=="cosmos"&&this.options.range.right>=0?n.strokeText("Today",this.width-t.horizontalTextMargin-n.measureText("Today").width,t.verticalTextMargin):n.strokeText(r,this.width-t.horizontalTextMargin-n.measureText(r).width,t.verticalTextMargin);var s=0,h=0,o=0,i=0;for(this.options.mode=="date"&&(r=(this.beta<=-2?t.months[this.startDate.month]+", ":"")+(this.startDate.year>0?this.startDate.year+" CE":-this.startDate.year+(this.startDate.year==0?1:0)+" BCE"),h=n.measureText(r).width+5,n.strokeText(r,5,t.verticalTextMargin*2),r=(this.beta<=-2?t.months[this.endDate.month]+", ":"")+(this.endDate.year>0?this.endDate.year+" CE":-this.endDate.year+(this.endDate.year==0?1:0)+" BCE"),o=n.measureText(r).width+5,n.strokeText(r,this.width-o,t.verticalTextMargin*2)),f=this.width/(this.options.range.right-this.options.range.left),l=-f*this.options.range.left,u=0;u<this.ticks.length;u++)i=f*(this.ticks[u]-this.options.range.left),this.options.mode=="calendar"&&(i+=f*this.firstYear),i<=l&&(n.beginPath(),n.lineWidth=t.strokeWidth,n.moveTo(i,t.axisHeight-t.strokeWidth),n.lineTo(i,t.axisHeight-t.strokeWidth-t.tickLength),n.closePath(),n.stroke(),s=n.measureText(this.labels[u]).width,e=!0,(h!=0||o!=0)&&(h!=0&&i-s/2-5<h&&(e=e&&!1),o!=0&&i+s/2+5>this.width-o&&(e=e&&!1)),e&&(n.lineWidth=1,n.strokeText(this.labels[u],i-s/2,t.verticalTextMargin*2)));if(this.minorTicks!=null)for(u=0;u<this.minorTicks.length;u++)i=f*(this.minorTicks[u]-this.options.range.left),this.options.mode=="calendar"&&(i+=f*this.firstYear),n.beginPath(),n.lineWidth=t.strokeWidth,n.moveTo(i,t.axisHeight-t.strokeWidth),n.lineTo(i,t.axisHeight-t.strokeWidth-t.smallTickLength),n.closePath(),n.stroke()},_createTicks:function(){var n=this._getTicks(),f=n.ticks,e=n.labels,o=this._checkLabelsArrangement(f,e),i,r,u,s=0;if(o==-1)while(s++<t.maxTickArrangeIterations){if(this._decreaseTickCount(),n=this._getTicks(),i=n.ticks,r=n.labels,u=this._checkLabelsArrangement(i,r),u==1){this._increaseTickCount();break}if(f=i,e=r,u==0)break}if(o==1)while(s++<t.maxTickArrangeIterations){if(this._increaseTickCount(),n=this._getTicks(),i=n.ticks,r=n.labels,u=this._checkLabelsArrangement(i,r),u==-1){this._decreaseTickCount();break}if(f=i,e=r,u==0)break}return{ticks:f,labels:e}},_getTicks:function(){var e=[],l=[],h,c,ut,i,a,r,y,p,u,k,f,w,d;if(this.options.mode=="cosmos"||this.options.mode=="calendar"){h=Math.max(this.options.range.left,t.maxPermitedTimeRange.left),c=Math.min(this.options.range.right,t.maxPermitedTimeRange.right),this.options.mode=="calendar"&&(h-=this.firstYear,c-=this.firstYear),ut=c-h,i=this.beta,this.options.mode=="cosmos"?this.regime=="Ga"&&i<5?i=5:this.regime=="Ma"&&i<2?i=2:this.regime=="ka"&&i<-1&&(i=-1):this.options.mode=="calendar"&&i<0&&(i=0);var s=this.delta*Math.pow(10,i),g=Math.floor(h/s),ft=Math.floor(c/s),nt=ft-g+1,et=g*s;for(s==2&&nt++,a=0;a<nt+1;a++)r=this._round(et+a*s,i),this.options.mode=="calendar"&&(r<0&&(r+=1),Math.abs(r)<1e-10&&s>1&&r++),r>=h&&r<=c&&r!=e[e.length-1]&&e.push(r);l=this._getLabels(e)}else if(this.options.mode=="date"){for(var tt=Math.min(this.options.range.right,0),it=Math.min(this.options.range.left,0),o=0,rt=0,v=this.startDate.month,b=this.startDate.year;b<this.endDate.year||b==this.endDate.year&&v<=this.endDate.month;)rt++,v++,v==12&&(v=0,b++);for(y=0,this.beta<=-2&&this.beta>=-4&&(o=5),this.beta<=-5&&(o=1),p=this.startDate.year,u=this.startDate.month-1,k=0;k<=rt+2;k++)if(u++,u==12&&(u=0,p++),f=n.Common.getCoordinateFromDMY(p,u,1),f>=it&&f<=tt&&o!=1&&(l.push(t.months[u]),e.push(f)),o!=0)for(y=Math.floor(t.daysInMonth[u]/o),o==5&&t.daysInMonth[u]>=30&&this.beta==-2&&y--,w=1;w<=y;w++)d=w*o,f=n.Common.getCoordinateFromDMY(p,u,d),f>=it&&f<=tt&&(l.push(d),e.push(f))}return{ticks:e,labels:l}},_getLabels:function(n){for(var r=[],i,u=Math.max(Math.floor(Math.log(this.delta*Math.pow(10,this.beta)/this.level)*this.log10),-4),t=0;t<n.length;t++)this.options.mode=="cosmos"?(i=-n[t]/this.level,u<0&&(i=new Number(i).toFixed(-u)),(t==0||t==n.length-1)&&(i+=this.regime)):(i=n[t]<=0?-n[t]+1:n[t],(t==0||t==n.length-1||i=="1")&&(i+=n[t]<=0?"BCE":"CE")),r.push(i);return r},_checkLabelsArrangement:function(n,i){var s=this.ticksCanvas[0],u=s.getContext("2d"),r,f,e,o;for(u.font=t.axisTextSize+" "+t.axisTextFont,r=0;r<n.length-1;r++)if(f=u.measureText(i[r]).width,e=u.measureText(i[r+1]).width,this._getCoordinateFromTick(n[r])+f/2+t.spaceBetweenLabels>this._getCoordinateFromTick(n[r+1])-e/2)return-1;for(o=1,r=0;r<n.length-1;r++)if(f=u.measureText(i[r]).width,e=u.measureText(i[r+1]).width,this._getCoordinateFromTick(n[r])+f/2+t.spaceBetweenLabels>this._getCoordinateFromTick(n[r+1])-e/2){o=0;break}return o},_getCoordinateFromTick:function(n){return(n-this.options.range.left)*this.width/(this.options.range.right-this.options.range.left)},_decreaseTickCount:function(){this.delta==1?this.delta=2:this.delta==2?this.delta=5:this.delta==5&&(this.delta=1,this.beta++),this._setMode()},_increaseTickCount:function(){this.delta==1?(this.delta=5,this.beta--):this.delta==2?this.delta=1:this.delta==5&&(this.delta=2),this._setMode()},_round:function(n,t){var i=1,r;if(t<=0){for(t=Math.max(0,Math.min(-t,15)),i=1,r=0;r>t;r--)i/=10;return Math.round(n*i)/i}for(i=1,r=0;r<t;r++)i*=10;return i*Math.round(n/i)},_setMode:function(){this.options.range.left<=-1e10?(this.regime="Ga",this.options.mode="cosmos",this.level=1e9):this.options.range.left<=-1e7?(this.regime="Ma",this.options.mode="cosmos",this.level=1e6):this.options.range.left<=-1e4?(this.regime="ka",this.options.mode="cosmos",this.level=1e3):this.beta<0?(this.regime="Date",this.options.mode="date",this.level=1):(this.regime="BCE/CE",this.options.mode="calendar",this.level=1)},_createMinorTicks:function(i){var o=[],l=Math.max(this.options.range.left,t.maxPermitedTimeRange.left),a=Math.min(this.options.range.right,t.maxPermitedTimeRange.right),c,s,e,v,r,u;this.options.mode=="calendar"&&(l-=this.firstYear,a-=this.firstYear);var h=5,s=this.width/(this.options.range.right-this.options.range.left),y=i.length>1?i[1]-i[0]:0,f=y/(h+1);if(this.options.mode=="cosmos"||this.options.mode=="calendar"){if(s*f<t.spaceBetweenSmallTicks)return null;for(r=i[0]-f;r>l;)o.push(r),r-=f;for(e=0;e<i.length-1;e++)for(c=i[e],f>1e-10+1/(h+1)&&Math.abs(c-1)<1e-10&&(c=0),s=1;s<=h;s++)r=c+f*s,o.push(r);for(r=i[i.length-1]+f;r<a;)o.push(r),r+=f}else{if(this.beta>=-1)f=5;else if(this.beta<=-2&&this.beta>=-4)f=1;else if(this.beta<=-5)return null;for(r=i[0],u=n.Common.getDMYFromCoordinate(r),u.day-=f,r=n.Common.getCoordinateFromDMY(u.year,u.month,u.day);r>l;)o.push(r),u.day-=f,r=n.Common.getCoordinateFromDMY(u.year,u.month,u.day);for(e=0;e<i.length-1;e++){var r=i[e],u=n.Common.getDMYFromCoordinate(r),h=Math.floor(t.daysInMonth[u.month]/f);for(v=1;v<=h;v++)u.day+=f,u.day==f+1&&f!=1&&u.day--,r=n.Common.getCoordinateFromDMY(u.year,u.month,u.day),(o.length==0||s*(i[e+1]-r)>t.spaceBetweenSmallTicks)&&o.push(r)}for(r=i[i.length-1],u=n.Common.getDMYFromCoordinate(r),u.day+=f,r=n.Common.getCoordinateFromDMY(u.year,u.month,u.day);r<a;)o.push(r),u.day+=f,r=n.Common.getCoordinateFromDMY(u.year,u.month,u.day)}return o},setRange:function(i,r){var u,f;i<r?(this.options.range.left=i,this.options.range.right=r):(this.options.range.left=t.maxPermitedTimeRange.left,this.options.range.right=t.maxPermitedTimeRange.right),u=n.Common.getPresent(),this.options.present={year:u.getUTCFullYear(),month:u.getUTCMonth(),day:u.getUTCDate()},this.firstYear=n.Common.getCoordinateFromDMY(0,0,1),this.mode!="cosmos"&&(this.startDate=this.options.present,this.endDate=this.options.present,this.options.range.left<0&&(this.startDate=n.Common.getDMYFromCoordinate(this.options.range.left)),this.options.range.right<0&&(this.endDate=n.Common.getDMYFromCoordinate(this.options.range.right))),this.delta=1,this.beta=Math.floor(Math.log(this.options.range.right-this.options.range.left)*this.log10),this._setMode(),this.thresholds!=null&&this._setThresholdsVisibility(),f=this._createTicks(),this.ticks=f.ticks,this.labels=f.labels,this.minorTicks=this._createMinorTicks(this.ticks),this._drawTicks(),this._drawCollapsedThresholds(),this._drawNotCollapsedThresholds(),this._renderMarker()},_setThresholdsVisibility:function(){for(var u=this.width/(this.options.range.right-this.options.range.left),r=0,i,n=0;n<this.numberOfThresholds;n++)this.thresholds[n].time>=this.options.range.left&&this.thresholds[n].time<=this.options.range.right?(this.thresholds[n].isVisible=!0,r=Math.floor(u*(this.thresholds[n].time-this.options.range.left)),this.thresholds[n].coordinate=n==this.numberOfThresholds-1&&r>0?r-t.thresholdWidth:r):this.thresholds[n].isVisible=!1;for(i=this.thresholds.length-1;i>0&&this.thresholds[i].coordinate-t.thresholdWidth<=this.thresholds[i-1].coordinate&&this.thresholds[i].isVisible;)this.thresholds[i-1].coordinate=this.thresholds[i].coordinate-t.thresholdWidth-1,i--;for(n=0;n<i;n++)this.thresholds[n].coordinate+t.thresholdWidth>=this.thresholds[n+1].coordinate&&this.thresholds[n].isVisible&&(this.thresholds[n+1].coordinate=this.thresholds[n].coordinate+t.thresholdWidth+1);this.thresholdVisibility=="one"&&($("#threshold"+n).css("left",this.element[0].offsetLeft+this.thresholds[this.currentThreshold].coordinate),$("#line"+n).css("left",this.element[0].offsetLeft+this.thresholds[this.currentThreshold].coordinate))},_renderMarker:function(){var s,i,c,r,o,f,e,h,u;r=this.markerPosition,s=this.mouseMarkCanvas[0],i=s.getContext("2d"),i.clearRect(0,0,s.width,s.height),r>=t.maxPermitedTimeRange.left&&r<=t.maxPermitedTimeRange.right&&(c=this.width/(this.options.range.right-this.options.range.left),r=c*(r-this.options.range.left),this.mousePosition=r,i.strokeStyle=t.axisStrokeColor,i.fillStyle=t.axisStrokeColor,i.beginPath(),o=t.axisHeight-t.strokeWidth,i.moveTo(r,o),i.lineTo(r+t.activeMarkSize/2,o-t.activeMarkSize),i.lineTo(r-t.activeMarkSize/2,o-t.activeMarkSize),i.lineTo(r,o),i.closePath(),i.fill(),i.font=t.axisTextSize-1+" "+t.axisTextFont,this.options.mode=="cosmos"?(e=Math.max(Math.floor(Math.log(this.delta*Math.pow(10,this.beta)/this.level)*this.log10),-4)-1,e>20&&(e=20),e<-20&&(e=-20),f=e<0?new Number(-this.markerPosition/this.level).toFixed(-e):new Number(-this.markerPosition/this.level).toFixed(e)):this.options.mode=="calendar"?(f=parseFloat(new Number(this.markerPosition-this.firstYear).toFixed(2)),f+=f>0?-.5:-1.5,f=Math.round(f),f<0?f=-f:f==0&&(f=1)):(h=n.Common.getDMYFromCoordinate(this.markerPosition),f=(this.beta>-3?h.month+1+".":"")+h.day),u=i.measureText(f).width,i.fillStyle="Black",i.globalAlpha=.75,i.beginPath(),i.moveTo(r-u+t.rectangleRadius,t.verticalTextMargin),i.lineTo(r-u+u*2-t.rectangleRadius,t.verticalTextMargin),i.quadraticCurveTo(r-u+u*2,t.verticalTextMargin,r-u+u*2,t.verticalTextMargin+t.rectangleRadius),i.lineTo(r-u+u*2,t.verticalTextMargin*2+t.gapLabelTick-t.rectangleRadius),i.quadraticCurveTo(r-u+u*2,t.verticalTextMargin*2+t.gapLabelTick,r-u+u*2-t.rectangleRadius,t.verticalTextMargin*2+t.gapLabelTick),i.lineTo(r-u+t.rectangleRadius,t.verticalTextMargin*2+t.gapLabelTick),i.quadraticCurveTo(r-u,t.verticalTextMargin*2+t.gapLabelTick,r-u,t.verticalTextMargin*2+t.gapLabelTick-t.rectangleRadius),i.lineTo(r-u,t.verticalTextMargin+t.rectangleRadius),i.quadraticCurveTo(r-u,t.verticalTextMargin,r-u+t.rectangleRadius,t.verticalTextMargin),i.closePath(),i.fill(),i.globalAlpha=1,i.strokeText(f,r-u/2,t.verticalTextMargin*2))},setTimeMarker:function(n){this.markerPosition=n,this._renderMarker()},getRange:function(){return{left:this.options.range.left,right:this.options.range.right}},Ticks:function(){return this.ticks},Labels:function(){return this.labels},Regime:function(){return this.regime},Mode:function(){return this.options.mode},MarkerPosition:function(){return this.markerPosition},updateWidth:function(){var t=this.element[0].clientWidth,n=this.backgroundCanvas[0],i;n.width=t,n=this.ticksCanvas[0],n.width=t,n=this.mouseMarkCanvas[0],n.width=t,n=this.thresholdCanvas[0],n.width=t,this.width=t,i=this._createTicks(),this.ticks=i.ticks,this.labels=i.labels,this._drawBackground(),this._drawTicks(),this._drawCollapsedThresholds(),this._drawNotCollapsedThresholds()},options:{range:{left:-1,right:0},present:null,mode:null}})})(n.Axis||(n.Axis={}));var t=n.Axis})(ChronoZoom||(ChronoZoom={}))