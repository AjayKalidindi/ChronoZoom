var ChronoZoom;(function(n){(function(){function u(n){n.left=getCoordinateFromDecimalYear(n.FromYear),n.right=getCoordinateFromDecimalYear(n.ToYear),n.Exhibits.forEach(function(n){n.x=getCoordinateFromDecimalYear(n.Year)}),n.ChildTimelines.forEach(function(t){t.ParentTimeline=n,u(t)}),l(n),n.Height?n.Height/=100:n.AspectRatio||n.Height||(n.Height=.4)}function l(n){n.ID==cosmosTimelineID&&(n.AspectRatio=10)}function f(n,t,r){var p=timelineHeaderSize+2*timelineHeaderMargin,c=n.right-n.left,s,h;n.width=c,n.AspectRatio&&!n.height&&(n.height=c/n.AspectRatio),n.ChildTimelines.forEach(function(t){t.AspectRatio?t.height=(t.right-t.left)/t.AspectRatio:n.height&&t.Height&&(t.height=n.height*t.Height),f(t,c,r)}),n.height||(s=undefined,n.ChildTimelines.forEach(function(n){if(n.Height&&!n.AspectRatio){var t=n.height/n.Height;(!s||s<t)&&(s=t)}}),s&&(n.ChildTimelines.forEach(function(n){if(n.Height&&!n.AspectRatio){var t=s*n.Height/n.height;t>1&&(n.realY*=t,o(n,t,r))}}),n.height=s));var y=v(n),b=a(n),u=e(n,y);if(n.height){if(h=i(n.height,n,r),n.Exhibits.length>0&&b.max-b.min<n.height)while(u.max-u.min>n.height-h.bboxHeight&&y>c/20)y/=1.5,u=e(n,y);if(u.max-u.min>n.height-h.bboxHeight&&Log){Log.push("Warning: Child timelines and exhibits doesn't fit into parent. Timeline name: "+n.Title);var w=u.max-u.min,l=w/(1-p),h=i(l,n,r);n.height=l}n.titleRect=h}else{var k=u.min,d=u.max,g=1/timelineMinAspect,nt=c/g,w=Math.max((1-p)*nt,d-k),l=w/(1-p),h=i(l,n,r);n.titleRect=h,n.height=l}n.heightEps=t*timelineContentMargin,n.realHeight=n.height+2*n.heightEps,n.realY=0,n.Exhibits.forEach(function(n){n.realY-=u.min}),n.ChildTimelines.forEach(function(n){n.realY-=u.min})}function r(n,t,i){n.forEach(function(n){var s=[],e,u,f,o,h,r;if(t.forEach(function(t){i(n,t)&&s.push({top:t.realY+t.realHeight,bottom:t.realY})}),e=0,s.length>0){for(u=[],s.forEach(function(n){u.push({type:"bottom",value:n.bottom}),u.push({type:"top",value:n.top})}),u.sort(function(n,t){return n.value-t.value}),f=[],o=0,r=0;r<u.length-1;r++)u[r].type=="top"?o++:o--,o==0&&u[r+1].type=="bottom"&&f.push({bottom:u[r].value,top:u[r+1].value});for(h=!1,r=0;r<f.length;r++)if(f[r].top-f[r].bottom>n.realHeight){e=f[r].bottom,h=!0;break}h||(e=u[u.length-1].value)}n.realY=e,t.push(n)})}function e(n,t){var e=[],o=[],i,u,f;return n.ChildTimelines.forEach(function(n){n.Sequence?e.push(n):o.push(n)}),n.Exhibits.forEach(function(i){i.size=t,i.left=i.x-i.size/2,i.right=i.x+i.size/2,i.realHeight=t,i.left<n.left?(i.left=n.left,i.right=i.left+i.size,i.isDeposed=!0):i.right>n.right&&(i.right=n.right,i.left=n.right-i.size,i.isDeposed=!0),i.Sequence?e.push(i):o.push(i)}),e.sort(function(n,t){return n.Sequence-t.Sequence}),i=[],r(e,i,function(n,t){return n.left<t.right}),r(o,i,function(n,t){return!(n.left>=t.right||t.left>=n.right)}),u=Number.MAX_VALUE,f=Number.MIN_VALUE,i.forEach(function(n){n.realY<u&&(u=n.realY),n.realY+n.realHeight>f&&(f=n.realY+n.realHeight)}),i.length==0&&(f=0,u=0),{max:f,min:u}}function a(n){var u=[],t,i;return r(n.ChildTimelines,u,function(n,t){return!(n.left>=t.right||t.left>=n.right)}),t=Number.MAX_VALUE,i=Number.MIN_VALUE,u.forEach(function(n){n.realY<t&&(t=n.realY),n.realY+n.realHeight>i&&(i=n.realY+n.realHeight)}),u.length==0&&(i=0,t=0),{max:i,min:t}}function o(n,t,r){if(t<1)throw"Only extending of content is allowed";n.height*=t,n.realHeight=n.height+2*n.heightEps,n.titleRect=i(n.height,n,r),n.ChildTimelines.forEach(function(n){n.realY*=t,n.AspectRatio||o(n,t,r)}),n.Exhibits.forEach(function(n){n.realY*=t})}function s(n){n.y=n.realY+n.heightEps,n.Exhibits.forEach(function(t){t.y=t.realY+t.size/2+n.y}),n.ChildTimelines.forEach(function(t){t.realY+=n.y,s(t)})}function v(n){return(n.right-n.left)/20}function i(n,t,i){var e=t.right-t.left;i.font="100pt "+timelineHeaderFontName;var o=i.measureText(t.Title),u=timelineHeaderSize*n,f=u*o.width/100,r=Math.min(n,e)*timelineHeaderMargin;return f+2*r>e&&(f=e-2*r,u=f*100/o.width),{width:f,height:u,marginTop:n-u-r,marginLeft:r,bboxWidth:f+2*r,bboxHeight:u+2*r}}function h(n,t){var r=y(t),i=addTimeline(n,"layerTimelines","t"+t.UniqueID,{timeStart:t.left,timeEnd:t.right,top:t.y,height:t.height,header:t.Title,fillStyle:"rgba(0,0,0,0.25)",titleRect:t.titleRect,strokeStyle:r,regime:t.Regime});t.Exhibits.forEach(function(n){var t,r=[],u;n.ContentItems||(n.ContentItems=[]),n.ContentItems.forEach(function(n){var i=n.MediaType;i=="Picture"?i="image":i=="Video"&&(i="video"),t=c(n),r.push({id:"c"+n.UniqueID,title:n.Title,mediaUrl:n.Uri,mediaType:i,description:n.Caption,date:t,guid:n.ID,attribution:n.Attribution,mediaSource:n.MediaSource,order:n.Order?n.Order:0})}),t=c(n),u=addInfodot(i,"layerInfodots","e"+n.UniqueID,(n.left+n.right)/2,n.y,.8*n.size/2,r,{title:n.Title,date:t,guid:n.ID})}),t.ChildTimelines.forEach(function(n){h(i,n)})}function c(n){var t;return n.Year?(t=n.Year,t<0&&(t<-999999999?(t/=-1e9,t+=" GA"):t<-999999?(t/=-1e6,t+=" MA"):t<-999?(t/=-1e3,t+=" KA"):(t/=-1,t+=" BCE"))):t=n.Date,t}function n(n,t){if(n.ID==t)return 0;if(!n.ParentTimeline)return-1;for(var r=0,i=n;i.ParentTimeline&&i.ID!=t;)i=i.ParentTimeline,r++;return i.ID!=t?-1:r}function t(n,t,i,r){return n==-1?"rgba(255, 255, 255, 0.5)":n==0?t:n%2!=0?i:r}function y(i){return i.Regime=="Cosmos"?t(n(i,cosmosTimelineID),"rgba(152, 108, 157, 1.0)","rgba(94, 78, 129, 1.0)","rgba(149, 136, 193, 1.0)"):i.Regime=="Earth"?t(n(i,earthTimelineID),"rgba(81, 127, 149, 1.0)","rgba(11, 110, 131, 1.0)","rgba(117, 163, 174, 1.0)"):i.Regime=="Life"?t(n(i,lifeTimelineID),"rgba(73, 150, 73, 1.0)","rgba(13, 106, 49, 1.0)","rgba(139, 167, 97, 1.0)"):i.Regime=="Pre-history"?t(n(i,prehistoryTimelineID),"rgba(237, 145, 50, 1.0)","rgba(193, 90, 47, 1.0)","rgba(223, 161, 68, 1.0)"):i.Regime=="Humanity"?t(n(i,humanityTimelineID),"rgba(212, 92, 70, 1.0)","rgba(140, 72, 69, 1.0)","rgba(207, 124, 111, 1.0)"):"rgba(255, 255, 255, 0.5)"}var p=function(n,t,i){var r=undefined,e,u,f;if(n)for(e=n.ChildTimelines.length,u=0;u<e;u++)if(f=n.ChildTimelines[u],f.ID==t){r=f;break}else if(i==!0&&(r=p(f,t,i),r!=undefined))break;return r}})(n.Layout||(n.Layout={}));var t=n.Layout})(ChronoZoom||(ChronoZoom={}))