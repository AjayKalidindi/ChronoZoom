var ChronoZoom;(function(n){(function(){function n(n,t,i,r,u,f,e){this.vc=n,this.id=i,this.layerid=t,this.x=r,this.y=u,this.width=f,this.height=e,this.children=[],this.isVisible=function(n){var t=this.x+this.width,i=this.y+this.height;return Math.max(this.x,n.Left)<=Math.min(t,n.Right)&&Math.max(this.y,n.Top)<=Math.min(i,n.Bottom)},this.isInside=function(n){return n.x>=this.x&&n.x<=this.x+this.width&&n.y>=this.y&&n.y<=this.y+this.height},this.render=function(){}}function u(n,i,r,u,f,e,o,s,h,c){return t(n,new it(n.vc,i,r,u,f,e,o,s,h,c),!1)}function pt(n,i,r,u,f,e,o,s,h){return t(n,new l(n.vc,i,r,u,f,e,o,s,h),!1)}function p(n){n.isRendered=!1,n.onIsRenderedChanged&&n.onIsRenderedChanged();for(var t=n.children.length;--t>=0;)n.children[t].isRendered&&p(n.children[t])}function g(n){for(var r=n.children.length,t,i=0;i<r;i++)t=n.children[i],g(t),t.onRemove&&t.onRemove(),t.parent=null;n.children=[]}function wt(t,i,r,u,f,e,o){this.base=n,this.base(t,i,r,u,f,e,o),this.isVisible=function(){return this.children.length!=0},this.beginEdit=function(){return this},this.endEdit=function(n){n||this.vc.invalidate()},this.isInside=function(){return!0},this.render=function(n,i,r){var f,u;if(this.vc.breadCrumbs=[],this.isVisible(i)){for(f=this.children.length,u=0;u<f;u++)d(this.children[u],n,i,r,1);this.vc.breadCrumbs.length>0&&(this.vc.recentBreadCrumb==undefined||this.vc.breadCrumbs[t.breadCrumbs.length-1].vcElement.title!=this.vc.recentBreadCrumb.vcElement.title)?(this.vc.recentBreadCrumb=this.vc.breadCrumbs[t.breadCrumbs.length-1],this.vc.breadCrumbsChanged()):this.vc.breadCrumbs.length==0&&this.vc.recentBreadCrumb!=undefined&&(this.vc.recentBreadCrumb=undefined,this.vc.breadCrumbsChanged())}}}function bt(n){var t=Math.max(n.x,n.y),r,i;if(t<=1)return 0;for(r=t&1?1:0,i=1;i<32;i++)t=t>>>1,t&1&&(r=r>0?i+1:i);return r}function r(i,r,u,e,o,s,h){var c,l,a;this.base=n,this.base(i,r,u,e,o,s,h),this.zoomLevel=0,this.prevContent=null,this.newContent=null,this.asyncContent=null,this.lastRenderTime=0,c=this,this.changeZoomLevel=function(){return null},l=function(n){c.lastRenderTime=new Date,c.prevContent=c.content,c.content=n.content,t(c,c.content,!1),c.prevContent&&(c.prevContent.opacity||(c.prevContent.opacity=1),c.content.opacity=0),c.zoomLevel=n.zoomLevel},a=function(){c.asyncContent&&(l(c.asyncContent),c.asyncContent=null,delete this.onLoad,c.vc.requestInvalidate())},this.render=function(n,t,i,r){var s,e,h,v;if(!this.asyncContent&&(this.prevContent||(s=bt(r),this.zoomLevel!=s&&(e=this.changeZoomLevel(this.zoomLevel,s),e&&(e.content.isLoading?(this.asyncContent=e,e.content.onLoad=a):l(e)))),this.prevContent)){h=new Date,v=h-c.lastRenderTime,c.lastRenderTime=h;var y=v/1600,o=!1,u=this.prevContent.opacity;u=Math.max(0,u-y),u!=this.prevContent.opacity&&(o=!0),u==0?(f(this,this.prevContent.id),this.prevContent=null):this.prevContent.opacity=u,u=this.content.opacity,u=Math.min(1,u+y),o||u==this.content.opacity||(o=!0),this.content.opacity=u,o&&this.vc.requestInvalidate()}},this.onIsRenderedChanged=function(){typeof this.removeWhenInvisible!="undefined"&&this.removeWhenInvisible&&(this.isRendered||(this.asyncContent&&(this.asyncContent=null),this.prevContent&&(f(this,this.prevContent.id),this.prevContent=null),this.newContent&&(f(this,this.newContent.id),this.newContent.content.onLoad=null,this.newContent=null),this.content&&(f(this,this.content.id),this.content=null),this.zoomLevel=0))}}function e(t,i,r,u,f,e,o){this.base=n,this.base(t,i,r,u,f,e,o),this.render=function(){}}function h(t,i,r,u,f,e,o,s){this.base=n,this.base(t,i,r,u,f,e,o),this.settings=s,this.render=function(n,t,i,r,u){var e=i.pointVirtualToScreen(this.x,this.y),o=i.pointVirtualToScreen(this.x+this.width,this.y+this.height),s=Math.max(0,e.x),h=Math.max(0,e.y),c=Math.min(i.width,o.x),l=Math.min(i.height,o.y),v,a,y,f;s<c&&h<l&&(this.settings.fillStyle&&(v=this.settings.gradientOpacity?u*(1-this.settings.gradientOpacity):u,n.globalAlpha=v,n.fillStyle=this.settings.fillStyle,n.fillRect(s,h,c-s,l-h),this.settings.gradientOpacity&&this.settings.gradientFillStyle&&(a=n.createLinearGradient(s,l,c,h),y="rgba(0, 0, 0, 0)",a.addColorStop(0,this.settings.gradientFillStyle),a.addColorStop(1,y),n.globalAlpha=u*this.settings.gradientOpacity,n.fillStyle=a,n.fillRect(s,h,c-s,l-h))),n.globalAlpha=u,this.settings.strokeStyle&&(n.strokeStyle=this.settings.strokeStyle,n.lineWidth=this.settings.lineWidth?this.settings.isLineWidthVirtual?i.widthVirtualToScreen(this.settings.lineWidth):this.settings.lineWidth:1,f=n.lineWidth/2,this.settings.outline&&(e.x+=f,e.y+=f,h+=f,l-=f,s+=f,c-=f,o.x-=f,o.y-=f),e.x>0&&(n.beginPath(),n.moveTo(e.x,h-f),n.lineTo(e.x,l+f),n.stroke()),e.y>0&&(n.beginPath(),n.moveTo(s-f,e.y),n.lineTo(c+f,e.y),n.stroke()),o.x<i.width&&(n.beginPath(),n.moveTo(o.x,h-f),n.lineTo(o.x,l+f),n.stroke()),o.y<i.height&&(n.beginPath(),n.moveTo(s-f,o.y),n.lineTo(c+f,o.y),n.stroke())))}}function nt(n,t,i,r,f,e,o,s,c){this.base=h,this.base(n,t,i,r,f,e,o),this.settings=s,this.parent=undefined,this.currentlyObservedTimelineEvent=n.currentlyObservedTimelineEvent,this.settings.outline=!0,this.type="timeline";var w=c.timeEnd-c.timeStart,l=c.titleRect?c.titleRect.height:timelineHeaderSize*c.height,v=c.titleRect?c.titleRect.marginLeft:timelineHeaderMargin*c.height,a=c.titleRect?c.titleRect.marginTop:(1-timelineHeaderMargin)*c.height-l,p=c.top+a+l/2;this.titleObject=u(this,t,i+"__header__",c.timeStart+v,c.top+a,p,l,c.header,{fontName:timelineHeaderFontName,fillStyle:timelineHeaderFontColor,textBaseline:"middle"},null),this.title=this.titleObject.text,this.regime=c.regime,this.settings.gradientOpacity=0,this.settings.gradientFillStyle=c.strokeStyle?c.strokeStyle:timelineBorderColor,this.reactsOnMouse=!0,this.tooltipEnabled=!0,this.tooltipIsShown=!1,this.onmouseclick=function(n){return y(this,n,1)},this.onmousehover=function(){if(this.vc.currentlyHoveredTimeline!=null&&this.vc.currentlyHoveredTimeline.id!=i)try{this.vc.currentlyHoveredInfodot.id}catch(t){stopAnimationTooltip(),this.vc.currentlyHoveredTimeline.tooltipIsShown=!1}if(this.vc.currentlyHoveredTimeline=this,this.settings.strokeStyle=timelineHoveredBoxBorderColor,this.settings.lineWidth=timelineHoveredLineWidth,this.titleObject.settings.fillStyle=timelineHoveredHeaderFontColor,this.settings.hoverAnimationDelta=3/60,this.vc.requestInvalidate(),this.titleObject.initialized==!1){var n=this.vc.getViewport();this.titleObject.screenFontSize=timelineHeaderSize*n.heightVirtualToScreen(this.height)}if(this.tooltipEnabled=this.titleObject.screenFontSize<=timelineTooltipMaxHeaderSize?!0:!1,tooltipMode!="infodot"){if(tooltipMode="timeline",this.tooltipEnabled==!1){stopAnimationTooltip(),this.tooltipIsShown=!1;return}if(this.tooltipIsShown==!1){switch(this.regime){case"Cosmos":$(".bubbleInfo").attr("id","cosmosRegimeBox");break;case"Earth":$(".bubbleInfo").attr("id","earthRegimeBox");break;case"Life":$(".bubbleInfo").attr("id","lifeRegimeBox");break;case"Pre-history":$(".bubbleInfo").attr("id","prehistoryRegimeBox");break;case"Humanity":$(".bubbleInfo").attr("id","humanityRegimeBox")}$(".bubbleInfo span").text(this.title),this.panelWidth=$(".bubbleInfo").outerWidth(),this.panelHeight=$(".bubbleInfo").outerHeight(),this.tooltipIsShown=!0,animationTooltipRunning=$(".bubbleInfo").fadeIn()}}},this.onmouseunhover=function(){this.vc.currentlyHoveredTimeline!=null&&this.vc.currentlyHoveredTimeline.id==i&&(this.vc.currentlyHoveredTimeline=null,this.tooltipIsShown==!0&&tooltipMode=="timeline"&&(tooltipMode="default",stopAnimationTooltip(),$(".bubbleInfo").attr("id","defaultBox"),this.tooltipIsShown=!1)),this.settings.strokeStyle=c.strokeStyle?c.strokeStyle:timelineBorderColor,this.settings.lineWidth=timelineLineWidth,this.titleObject.settings.fillStyle=timelineHeaderFontColor,this.settings.hoverAnimationDelta=-3/60,this.vc.requestInvalidate()},this.base_render=this.render,this.render=function(t,i,r,u,f){var o;this.titleObject.initialized=!1,this.settings.hoverAnimationDelta&&(this.settings.gradientOpacity=Math.min(1,Math.max(0,this.settings.gradientOpacity+this.settings.hoverAnimationDelta))),this.base_render(t,i,r,u,f),this.settings.hoverAnimationDelta&&(this.settings.gradientOpacity==0||this.settings.gradientOpacity==1?this.settings.hoverAnimationDelta=undefined:this.vc.requestInvalidate());var e=r.pointVirtualToScreen(this.x,this.y),s={x:e.x+u.x,y:e.y+u.y},h=r.visible.centerX-timelineCenterOffsetAcceptableImplicity<=this.x+this.width&&r.visible.centerX+timelineCenterOffsetAcceptableImplicity>=this.x&&r.visible.centerY-timelineCenterOffsetAcceptableImplicity<=this.y+this.height&&r.visible.centerY+timelineCenterOffsetAcceptableImplicity>=this.y,c=e.x<timelineBreadCrumbBorderOffset&&s.x>r.width-timelineBreadCrumbBorderOffset||e.y<timelineBreadCrumbBorderOffset&&s.y>r.height-timelineBreadCrumbBorderOffset;if(c&&h){if(o=n.breadCrumbs.length,o>1&&n.breadCrumbs[o-1].vcElement.parent.id==this.parent.id)return;n.breadCrumbs.push({vcElement:this})}}}function c(t,i,r,u,f,e,o){this.base=n,this.base(t,i,r,u-e,f-e,2*e,2*e),this.settings=o,this.isObservedNow=!1,this.render=function(n,t,i,r,u){var f=this.width/2,o=this.x+f,s=this.y+f,e=i.pointVirtualToScreen(o,s),h=i.widthVirtualToScreen(f);n.globalAlpha=u,n.beginPath(),n.arc(e.x,e.y,h,0,Math.PI*2,!0),this.settings.strokeStyle&&(n.strokeStyle=this.settings.strokeStyle,n.lineWidth=this.settings.lineWidth?this.settings.isLineWidthVirtual?i.widthVirtualToScreen(this.settings.lineWidth):this.settings.lineWidth:1,n.stroke()),this.settings.fillStyle&&(n.fillStyle=this.settings.fillStyle,n.fill())},this.isInside=function(n){var t=sqr(n.x-u)+sqr(n.y-f);return t<=e*e}}function tt(n,t,i,r,u,f){var o=$.browser,h=o.msie&&parseInt(o.version,10)>=9;if(h)t.font=u+"pt "+f,t.fillText(n,i,r);else{var s=12,c=u,e=c/s;t.scale(e,e),t.font=s+"pt "+f,t.fillText(n,i/e,r/e),t.scale(1/e,1/e)}}function it(t,i,r,u,f,e,o,s,h,c){this.base=n,this.base(t,i,r,u,f,c?c:0,o),this.text=s,this.baseline=e,this.settings=h,typeof this.settings.textBaseline!="undefined"&&this.settings.textBaseline==="middle"&&(this.baseline=this.y+this.height/2),this.initialized=!1,this.screenFontSize=0,this.render=function(n,t,i,r,u){var e=i.pointVirtualToScreen(this.x,this.y),a=i.pointVirtualToScreen(this.x,this.baseline).y,f,h,b,v,s,nt,rt,o,p,w;if(n.globalAlpha=u,n.fillStyle=this.settings.fillStyle,f=r.y,h=1.5,this.screenFontSize!=f&&(this.screenFontSize=f),!this.initialized){if(this.settings.wrapText){for(b=this.settings.numberOfLines?this.settings.numberOfLines:1,this.settings.numberOfLines=b,f=r.y/b/h;;){n.font=f+"pt "+this.settings.fontName;var it=this.text.split("\n"),k=0,d=[];for(v=0;v<it.length;v++){var y=it[v].split(" "),c=0,l="",g,ut=n.measureText(" ").width;for(s=0;s<y.length;s++)g=n.measureText(y[s]),nt=c==0?c+g.width:c+g.width+ut,nt>r.x&&c>0?(d.push(l),c=0,k+=f*h,s--,l=""):(l===""?l=y[s]:l+=" "+y[s],c=nt);d.push(l),k+=f*h}if(k>r.y)f/=1.5;else{this.text=d,rt=i.heightScreenToVirtual(f),this.settings.fontSizeVirtual=rt;break}}this.screenFontSize=f}else n.font=f+"pt "+this.settings.fontName,this.screenFontSize=f,this.width==0?(o=n.measureText(this.text),r.x=o.width,this.width=i.widthScreenToVirtual(o.width)):(o=n.measureText(this.text),o.width>r.x?(this.height=this.width*r.y/o.width,this.settings.textBaseline==="middle"&&(this.y=this.baseline-this.height/2),f=i.heightVirtualToScreen(this.height),this.screenFontSize=f):typeof this.settings.adjustWidth&&this.settings.adjustWidth&&(p=i.widthScreenToVirtual(o.width),this.settings.textAlign==="center"?this.x=this.x+(this.width-p)/2:this.settings.textAlign==="right"&&(this.x=this.x+this.width-p),this.width=p,e=i.pointVirtualToScreen(this.x,this.y),r.x=i.widthVirtualToScreen(this.width)));this.initialized=!0}if(this.settings.textAlign&&(n.textAlign=this.settings.textAlign,this.settings.textAlign==="center"?e.x=e.x+r.x/2:this.settings.textAlign==="right"&&(e.x=e.x+r.x)),this.settings.wrapText)for(f=i.heightVirtualToScreen(this.settings.fontSizeVirtual),this.screenFontSize=f,n.textBaseline="middle",a=e.y+f*h/2,w=0;w<this.text.length;w++)tt(this.text[w],n,e.x,a,f,this.settings.fontName),a+=f*h;else this.settings.textBaseline&&(n.textBaseline=this.settings.textBaseline),tt(this.text,n,e.x,a,f,this.settings.fontName)},this.isVisible=function(n){var t=this.y+this.height,i;return this.width>0?(i=this.x+this.width,Math.max(this.x,n.Left)<=Math.min(i,n.Right)&&Math.max(this.y,n.Top)<=Math.min(t,n.Bottom)):Math.max(this.y,n.Top)<=Math.min(t,n.Bottom)}}function rt(t,i,r,u,f,e,o,s,h){this.base=n,this.base(t,i,r,u,f,e*10,e),this.settings=h,this.text=o,this.render=function(n,t,i,r){function e(n,t,i,r,u,f){var h,c;if(f=f||0,f<=0){n.fillText(t,i,r);return}for(var o=t.split(" "),s=0,e=1;o.length>0&&e<=o.length;)h=o.slice(0,e).join(" "),c=n.measureText(h).width,c>f?(e==1&&(e=2),n.fillText(o.slice(0,e-1).join(" "),i,r+u*s),s++,o=o.splice(e-1),e=1):e++;e>0&&n.fillText(o.join(" "),i,r+u*s)}var f=i.pointVirtualToScreen(this.x,this.y),u;n.fillStyle=h.fillStyle,n.font=r.y+"pt "+h.fontName,n.textBaseline="top",u=i.heightVirtualToScreen(this.height),e(n,this.text,f.x,f.y,u,s*u)}}function o(t,i,r,u,f,e,o,s,h){var c;this.base=n,this.base(t,i,r,f,e,o,s),this.onload=h,this.isLoading=!0,c=new Image,this.img=c,this.img.isLoaded=!1;var l=this,a=function(){var i,n,r,u,t;c.isLoading=!1,c.isRemoved?(delete c.isRemoved,delete c.isLoaded):(c.naturalHeight&&(i=l.width/l.height,n=c.naturalWidth/c.naturalHeight,i>n?(r=n*l.height,t=(l.width-r)/2,l.x+=t,l.width=r):i<n&&(u=l.width/n,t=(l.height-u)/2,l.y+=t,l.height=u)),c.isLoaded=!0,l.onLoad&&l.onLoad(),l.vc.requestInvalidate())},v=function(){if(c.isFallback)throw"Cannot load an image!";else c.isFallback=!0,c.src=fallbackImageUri};this.img.addEventListener("load",a,!1),h&&this.img.addEventListener("load",h,!1),this.img.addEventListener("error",v,!1),this.img.src=u,this.render=function(n,t,i,r,u){if(this.img.isLoaded){var f=i.pointVirtualToScreen(this.x,this.y);n.globalAlpha=u,n.drawImage(this.img,f.x,f.y,r.x,r.y)}},this.onRemove=function(){this.img.removeEventListener("load",a,!1),this.img.removeEventListener("error",v,!1),this.onload&&this.img.removeEventListener("load",this.onload,!1),this.img.isRemoved=!0,delete this.img}}function ut(n,t,i,u,f,e,s,h,c){this.base=r,this.base(n,t,i,f,e,s,h),this.imageSources=u,this.changeZoomLevel=function(r,u){var l=this.imageSources.length;if(l==0)return null;for(;--l>=0;)if(this.imageSources[l].zoomLevel<=u)return this.imageSources[l].zoomLevel===r?null:{zoomLevel:this.imageSources[l].zoomLevel,content:new o(n,t,i+"@"+this.imageSources[l].zoomLevel,this.imageSources[l].imageSource,f,e,s,h,c)};return null}}function i(t,i,r,u,f,e,o,s){this.base=n,this.base(t,i,r,u,f,e,o),this.initializeContent=function(n){this.content=n,n&&(n.style.position="absolute",n.style.overflow="hidden",n.style.zIndex=s)},this.onIsRenderedChanged=function(){this.content&&(this.isRendered?(this.content.isAdded||(this.vc.element[0].appendChild(this.content),this.content.isAdded=!0),this.content.style.display="block"):this.content.style.display="none")},this.render=function(n,t,i,r,u){if(this.content){var f=i.pointVirtualToScreen(this.x,this.y),w=i.height,b=i.width,a=0,v=0,y=r.y,p=r.x,s=0,h=w,c=f.y,l=f.y+r.y,e=Math.max(s,c),o=Math.min(h,l);e<=o&&(a=e-f.y,y=o-f.y),s=0,h=b,c=f.x,l=f.x+r.x,e=Math.max(s,c),o=Math.min(h,l),e<=o&&(v=e-f.x,p=o-f.x),this.content.style.left=f.x+"px",this.content.style.top=f.y+"px",this.content.style.width=r.x+"px",this.content.style.height=r.y+"px",this.content.style.clip="rect("+a+"px,"+p+"px,"+y+"px,"+v+"px)",this.content.style.opacity=u,this.content.style.filter="alpha(opacity="+u*100+")"}},this.onRemove=function(){if(this.content)try{this.content.isAdded&&(this.content.src&&(this.content.src=""),this.vc.element[0].removeChild(this.content),this.content.isAdded=!1)}catch(n){alert(n.Description)}}}function l(n,t,r,u,f,e,o,s,h){var c,a;this.base=i,this.base(n,t,r,u,f,e,o,h),c=$("<div id='citext_"+r+"' class='contentItemDescription'><\/div").appendTo(n),c[0].addEventListener("mousemove",preventbubble,!1),c[0].addEventListener("mousedown",preventbubble,!1),c[0].addEventListener("DOMMouseScroll",preventbubble,!1),c[0].addEventListener("mousewheel",preventbubble,!1),a=$("<div style='position:relative' class='text'><\/div>").html(s).appendTo(c),this.initializeContent(c[0]),this.render=function(n,t,i,r,u){var f=r.y/contentItemDescriptionNumberOfLines;c.css("font-size",f+"px"),l.prototype.render.call(this,n,t,i,r,u)},this.onRemove=function(){l.prototype.onRemove.call(this),c[0].removeEventListener("mousemove",preventbubble,!1),c[0].removeEventListener("mouseup",preventbubble,!1),c[0].removeEventListener("mousedown",preventbubble,!1),c[0].removeEventListener("DOMMouseScroll",preventbubble,!1),c[0].removeEventListener("mousewheel",preventbubble,!1),c=undefined}}function ft(n,t,r,u,f,e,o,s,h){this.base=i,this.base(n,t,r,f,e,o,s,h);var c=document.createElement("iframe");c.setAttribute("id",r),u+=u.indexOf("?")==-1?"?wmode=opaque":"&wmode=opaque",c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function et(n,t,r,u,f,e,o,s,h){this.base=i,this.base(n,t,r,f,e,o,s,h);var c=document.createElement("iframe");c.setAttribute("id",r),u+=u.indexOf("?")==-1?"?wmode=opaque":"&wmode=opaque",c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function ot(n,t,r,u,f,e,o,s,h){this.base=i,this.base(n,t,r,f,e,o,s,h);var c=document.createElement("audio");c.setAttribute("id",r),c.setAttribute("src",u),c.setAttribute("visible","true"),c.setAttribute("controls","true"),this.initializeContent(c)}function a(n,t,r,u,e,o,s,h,c,l,v){var y=this,p;this.base=i,this.base(n,r,u,o,s,h,c,l),this.onload=v,this.nAttempts=0,this.timeoutHandles=[],p=document.createElement("div"),p.setAttribute("id",u),p.setAttribute("style","color: white"),this.initializeContent(p),this.viewer=new Seadragon.Viewer(p),this.viewer.elmt.addEventListener("mousemove",preventbubble,!1),this.viewer.elmt.addEventListener("mousedown",preventbubble,!1),this.viewer.elmt.addEventListener("DOMMouseScroll",preventbubble,!1),this.viewer.elmt.addEventListener("mousewheel",preventbubble,!1),this.viewer.addEventListener("open",function(){y.onload&&y.onload(),y.vc.requestInvalidate()}),this.viewer.addEventListener("resize",function(n){y.viewer.setDashboardEnabled(n.elmt.clientWidth>250)}),this.onSuccess=function(n){var t,i;if(n.error){y.showFallbackImage();return}if(t=n.content,t.ready){for(i=0;i<y.timeoutHandles.length;i++)clearTimeout(y.timeoutHandles[i]);y.viewer.openDzi(t.dzi)}else t.failed?y.showFallbackImage():y.nAttempts<seadragonMaxConnectionAttempts?(y.viewer.showMessage("Loading "+Math.round(100*t.progress)+"% done."),y.timeoutHandles.push(setTimeout(y.requestDZI,seadragonRetryInterval))):y.showFallbackImage()},this.onError=function(){y.nAttempts<seadragonMaxConnectionAttempts?y.timeoutHandles.push(setTimeout(y.requestDZI,seadragonRetryInterval)):y.showFallbackImage()},this.requestDZI=function(){y.nAttempts++,$.ajax({url:seadragonServiceURL+encodeURIComponent(e),dataType:"jsonp",success:y.onSuccess,error:y.onError})},this.render=function(n,t,i,r,u){y.viewer.isFullPage()||(a.prototype.render.call(this,n,t,i,r,u),y.viewer.viewport&&(y.viewer.viewport.resize({x:r.x,y:r.y}),y.viewer.viewport.update()))},this.onRemove=function(){y.viewer.close(),a.prototype.onRemove.call(this)},this.showFallbackImage=function(){for(var n=0;n<y.timeoutHandles.length;n++)clearTimeout(y.timeoutHandles[n]);y.onRemove(),f(t,y.id),ct(t,r,u,o,s,h,c,e,null)},y.requestDZI()}function s(n,t,i,f,s,h,c,l){this.base=r,this.base(n,t,i,f,s,h,c),this.type="contentItem";var k=c*contentItemTopTitleHeight*.8,p=c*contentItemMediaHeight,rt=contentItemFontHeight*c,a=h*contentItemContentWidth,v=(h-a)/2,b=c*contentItemVerticalMargin,w=s+b,nt=b*.4,tt=w+p+nt,ut=f+h-v,d=c*contentItemSourceHeight*.8,g=tt+b+d,it=ht(this,t,i+"__rect__",f,s,h,c,{strokeStyle:contentItemBoundingBoxBorderColor,lineWidth:contentItemBoundingBoxBorderWidth*h,fillStyle:contentItemBoundingBoxFillColor,isLineWidthVirtual:!0});this.reactsOnMouse=!0,this.onmouseenter=function(){it.settings.strokeStyle=contentItemBoundingHoveredBoxBorderColor,this.vc.currentlyHoveredContentItem=this,this.vc.requestInvalidate()},this.onmouseleave=function(){it.settings.strokeStyle=contentItemBoundingBoxBorderColor,this.vc.currentlyHoveredContentItem=null,this.isMouseIn=!1,this.vc.requestInvalidate()},this.onmouseclick=function(n){return y(this,n,1)},this.changeZoomLevel=function(r,y){var ht,ot,st,ct,ut,wt,bt;if(y>=contentItemShowContentZoomLevel){if(r>=contentItemShowContentZoomLevel)return null;var it=new e(n,t,i+"__content",f,s,h,c),ft=i+"__media__",et=null;return l.mediaType==="image"?et=lt(it,t,ft,f+v,w,a,p,mediaContentElementZIndex,l.mediaUrl,null):l.mediaType==="video"?at(it,t,ft,l.mediaUrl,f+v,w,a,p,mediaContentElementZIndex):l.mediaType==="audio"?(w+=contentItemAudioTopMargin*c,p=c*contentItemAudioHeight,yt(it,t,ft,l.mediaUrl,f+v,w,a,p,mediaContentElementZIndex)):l.mediaType==="pdf"&&vt(it,t,ft,l.mediaUrl,f+v,w,a,p,mediaContentElementZIndex),ht=l.title,u(it,t,i+"__title__",f+v,g,g+k/2,.9*k,ht,{fontName:contentItemHeaderFontName,fillStyle:contentItemHeaderFontColor,textBaseline:"middle",textAlign:"center",wrapText:!0,numberOfLines:1},a),ot=l.attribution,ot&&(st=function(r,f,e){var o=u(it,t,i+"__source__",r,e,e+d/2,.9*d,ot,{fontName:contentItemHeaderFontName,fillStyle:contentItemSourceFontColor,textBaseline:"middle",textAlign:"right",adjustWidth:!0},f);l.mediaSource&&(o.reactsOnMouse=!0,o.onmouseclick=function(){return n.element.css("cursor","default"),window.open(l.mediaSource),!0},o.onmouseenter=function(){this.settings.fillStyle=contentItemSourceHoveredFontColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","pointer")},o.onmouseleave=function(){this.settings.fillStyle=contentItemSourceFontColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","default")})},et?et.onLoad=function(){var n=this.x,t=this.width,i=this.y+this.height+nt;st(n,t,i),this.onLoad=null}:st(f+v,a,tt)),ct=g+k+b,pt(it,t,i+"__description__",f+v,ct,a,rt,l.description,30,{}),{zoomLevel:contentItemShowContentZoomLevel,content:it}}if(ut=y,ut>=contentItemThumbnailMaxLevel){if(r>=contentItemThumbnailMaxLevel&&r<contentItemShowContentZoomLevel)return null;ut=contentItemThumbnailMaxLevel}else if(ut<=contentItemThumbnailMinLevel){if(r<=contentItemThumbnailMinLevel&&r>0)return null;ut=contentItemThumbnailMinLevel}return wt=1<<ut,bt=contentItemThumbnailBaseUri+"x"+wt+"/"+l.guid+".png",{zoomLevel:y,content:new o(n,t,i+"@1",bt,f,s,h,c,null)}}}function w(n,i,f,s,h,l,a,v){var k;this.base=c,this.base(n,i,f,s,h,l,{strokeStyle:infoDotBorderColor,lineWidth:infoDotBorderWidth*l,fillStyle:infoDotFillColor,isLineWidthVirtual:!0}),this.contentItems=a,this.hasContentItems=!1,a.sort(function(n,t){return n.order-t.order}),k=l-infoDotHoveredBorderWidth*l,this.outerRad=l,this.type="infodot",this.reactsOnMouse=!0,this.tooltipEnabled=!0,this.tooltipIsShown=!1,this.onmouseenter=function(){this.settings.strokeStyle=infoDotHoveredBorderColor,this.settings.lineWidth=infoDotHoveredBorderWidth*l,this.vc.requestInvalidate(),this.vc.currentlyHoveredTimeline!=null&&(stopAnimationTooltip(),this.vc.currentlyHoveredTimeline.tooltipIsShown=!1),$(".bubbleInfo span").text(v.title),this.panelWidth=$(".bubbleInfo").outerWidth(),this.panelHeight=$(".bubbleInfo").outerHeight(),tooltipMode="infodot",this.tooltipEnabled==!0&&this.tooltipIsShown==!1&&(this.tooltipIsShown=!0,$(".bubbleInfo").attr("id","defaultBox"),animationTooltipRunning=$(".bubbleInfo").fadeIn()),this.vc.cursorPosition=s,this.vc.currentlyHoveredInfodot=this,this.vc._setConstraintsByInfodotHover(this),this.vc.RaiseCursorChanged()},this.onmouseleave=function(){this.isMouseIn=!1,this.settings.strokeStyle=infoDotBorderColor,this.settings.lineWidth=infoDotBorderWidth*l,this.vc.requestInvalidate(),this.tooltipIsShown==!0&&stopAnimationTooltip(),this.tooltipIsShown=!1,tooltipMode="default",this.vc.currentlyHoveredInfodot=undefined,this.vc._setConstraintsByInfodotHover(undefined),this.vc.RaiseCursorChanged()},this.onmouseclick=function(n){return y(this,n,1)};var nt=!0,p=this,d=new r(n,i,f+"_dlod",s-k,h-k,2*k,2*k);d.removeWhenInvisible=!0,t(this,d,!1),d.firstLoad=!0,d.changeZoomLevel=function(r,c){var rt,a,y,w,et,g;if(c>=infodotShowContentThumbZoomLevel&&c<infodotShowContentZoomLevel){if(rt=getURL(),typeof rt.hash.params!="undefined"&&typeof rt.hash.params.b!="undefined"&&(nt=!1),r>=infodotShowContentThumbZoomLevel&&r<infodotShowContentZoomLevel)return null;if(p.tooltipEnabled=!0,a=null,p.contentItems.length>0&&(a=new e(n,i,f+"__contentItems",d.x,d.y,2*k,2*k),y=b(p.contentItems,s,h,k,n,i),y))for(w=0;w<y.length;w++)t(a,y[w],!1);return a?(p.hasContentItems=!0,{zoomLevel:c,content:a}):null}if(c>=infodotShowContentZoomLevel){if(r>=infodotShowContentZoomLevel)return null;if(p.tooltipEnabled=!1,p.tooltipIsShown==!0&&(stopAnimationTooltip(),p.tooltipIsShown=!1),a=null,p.contentItems.length>0&&(a=new e(n,i,f+"__contentItems",d.x,d.y,2*k,2*k),y=b(p.contentItems,s,h,k,n,i),y))for(w=0;w<y.length;w++)t(a,y[w],!1);if(a==null)return null;var ut=infodotTitleWidth*l*2,ot=infodotTitleHeight*l*2,st=140/225*l,ht=h-st-ot,ct="";v&&v.title&&v.date&&(ct=v.title+"\n("+v.date+")"),u(a,i,f+"__title",s-ut/2,ht,ht,ot,ct,{fontName:contentItemHeaderFontName,fillStyle:contentItemHeaderFontColor,textBaseline:"middle",textAlign:"center",wrapText:!0,numberOfLines:2},ut);var lt=h+st+63/225*l,ft=infodotBibliographyHeight*l*2,at=ut/3,tt=u(a,i,f+"__bibliography",s-at/2,lt-ft,lt-ft/2,ft,"Bibliography",{fontName:contentItemHeaderFontName,fillStyle:timelineBorderColor,textBaseline:"middle",textAlign:"center"},at);if(tt.reactsOnMouse=!0,tt.onmouseclick=function(){return this.vc.element.css("cursor","default"),showBibliography({infodot:v,contentItems:p.contentItems},a,f+"__bibliography"),!0},tt.onmouseenter=function(){this.settings.fillStyle=infoDotHoveredBorderColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","pointer")},tt.onmouseleave=function(){this.settings.fillStyle=infoDotBorderColor,this.vc.requestInvalidate(),this.vc.element.css("cursor","default")},et=window.location.hash.match("b=([a-z0-9_]+)"),et&&nt&&showBibliography({infodot:v,contentItems:p.contentItems},a,et[1]),a)return p.hasContentItems=!0,{zoomLevel:c,content:a}}else{if((p.tooltipEnabled=!0,p.hasContentItems=!1,p.contentItems.length==0)||(g=c,g<=contentItemThumbnailMinLevel&&r<=contentItemThumbnailMinLevel&&r>0))return null;if(g>=contentItemThumbnailMaxLevel){if(r>=contentItemThumbnailMaxLevel&&r<infodotShowContentZoomLevel)return null;g=contentItemThumbnailMaxLevel}if(g<contentItemThumbnailMinLevel)return{zoomLevel:g,content:new e(n,i,f+"__empty",s,h,0,0)};var a=p.contentItems[0],vt=1<<g,yt=contentItemThumbnailBaseUri+"x"+vt+"/"+a.guid+".png",it=k*260/225;return{zoomLevel:g,content:new o(n,i,f+"@"+g,yt,s-it/2,h-it/2,it,it,null)}}};var g=1/225,tt=252*g,it=262*g,rt=3*g*l,ut=24*g*l,ft=-tt/2*l+s,et=-it/2*l+h,ot=tt/2*l+s,st=it/2*l+h;this.render=function(n,t,i,r,u){var s;if(w.prototype.render.call(this,n,t,i,r,u),s=i.widthVirtualToScreen(rt),!(s<.5)){var h=this.width/2,c=this.x+h,l=this.y+h,a=r.x/2,f=i.widthVirtualToScreen(ut),e=i.pointVirtualToScreen(ft,et),o=i.pointVirtualToScreen(ot,st);n.lineWidth=s,n.strokeStyle=contentItemBoundingBoxFillColor,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(e.x-f,e.y-f),n.stroke(),n.beginPath(),n.moveTo(o.x,o.y),n.lineTo(o.x+f,o.y+f),n.stroke(),n.beginPath(),n.moveTo(e.x,o.y),n.lineTo(e.x-f,o.y+f),n.stroke(),n.beginPath(),n.moveTo(o.x,e.y),n.lineTo(o.x+f,e.y-f),n.stroke()}}}function b(n,t,i,r,u,f){var p=n.length,et,ot,e,o;if(p<=0)return null;p--;var c=[],l=1/225,w=260*l,b=270*l,it=-w/2-38*l,st=-it,a=60*l,v=a,d=a*r,g=v*r,ht=-b/2-9*l-v/2,ct=-ht;c.push(new s(u,f,n[0].id,-w/2*r+t,-b/2*r+i,w*r,b*r,n[0]));var nt=Math.floor(p/3),tt=p%3,rt=nt+(tt>0?1:0),ut=nt+(tt>1?1:0),ft=nt+(tt>2?1:0),h=1,y=k(rt,v),lt=t+r*(it-a/2);for(e=0;e<rt;e++,h++)o=n[h],c.push(new s(u,f,o.id,lt,i+r*y[e],d,g,o));for(y=k(ft,a),et=i+r*(ct-v/2),e=0;e<ft;e++,h++)o=n[h],c.push(new s(u,f,o.id,t+r*y[e],et,d,g,o));for(y=k(ut,v),ot=t+r*(st-a/2),e=ut;--e>=0;h++)o=n[h],c.push(new s(u,f,o.id,ot,i+r*y[e],d,g,o));return c}function k(n,t){if(n==0)return null;var r=.05*t,i,u,f,e;return n%2==0?(i=-r/2-t,u=r/2,n==4)?(f=i-t-r,e=u+r+t,[f,i,u,e]):[i,u]:(i=-t/2,n>1)?(u=t/2+r,f=i-t-r,[f,i,u]):[i]}var v=$.Event("elementclick"),st=function(n,t,i){var f=2*(contentScaleMargin?contentScaleMargin:0),u=i.width-f,e,r,o,s;return u<0&&(u=i.width),e=t*n.width/u,r=i.height-f,r<0&&(r=i.height),o=t*n.height/r,s={centerX:n.x+n.width/2,centerY:n.y+n.height/2,scale:Math.max(e,o)},s},y=function(n,t,i){var r=n.vc.getViewport(),u=st(n,i,r);return v.newvisible=u,v.element=n,n.vc.element.trigger(v),!0},ht=function(n,i,r,u,f,e,o,s){return t(n,new h(n.vc,i,r,u,f,e,o,s),!1)},ni=function(n,i,r,u,f,e,o,s){return t(n,new c(n.vc,i,r,u,f,e,o),s)},ct=function(n,i,r,u,f,e,s,h,c){if(e<=0||s<=0)throw"Image size must be positive";return t(n,new o(n.vc,i,r,h,u,f,e,s,c),!1)},ti=function(n,i,r,u,f,e,o,s,h){if(e<=0||o<=0)throw"Image size must be positive";return t(n,new ut(n.vc,i,r,s,u,f,e,o,h),!1)},lt=function(n,i,r,u,f,e,o,s,h,c){if(e<=0||o<=0)throw"Image size must be positive";return t(n,new a(n.vc,n,i,r,h,u,f,e,o,s,c),!1)},at=function(n,i,r,u,f,e,o,s,h){return t(n,new et(n.vc,i,r,u,f,e,o,s,h),!1)},vt=function(n,i,r,u,f,e,o,s,h){return t(n,new ft(n.vc,i,r,u,f,e,o,s,h),!1)},yt=function(n,i,r,u,f,e,o,s,h){return t(n,new ot(n.vc,i,r,u,f,e,o,s,h),!1)},d=function(n,t,i,r,u){var f,s,o,h,e;if(!n.isVisible(i)){n.isRendered&&p(n);return}if(f=r.vectorVirtualToScreen(n.width,n.height),f.y<=renderThreshold||n.width!=0&&f.x<=renderThreshold){n.isRendered&&p(n);return}for(s=t[n.layerid],n.opacity!=null&&(u*=n.opacity),n.isRendered!=undefined&&n.isRendered||(n.isRendered=!0,n.onIsRenderedChanged&&n.onIsRenderedChanged()),n.render(s,i,r,f,u),o=n.children,h=o.length,e=0;e<h;e++)d(o[e],t,i,r,u)},t=function(n,t,i){var r=n.width==Infinity||t.x>=n.x&&t.x+t.width<=n.x+n.width&&t.y>=n.y&&t.y+t.height<=n.y+n.height;if(!r&&Log&&Log.push("Child element does not belong to the parent element "+n.id+" "+t.ID),!i&&!r)throw"Child element does not belong to the parent element";return n.children.push(t),t.parent=n,t},f=function(n,t){for(var u=n.children.length,i,r=0;r<u;r++)if(i=n.children[r],i.id==t)return n.children.splice(r,1),g(i),i.onRemove&&i.onRemove(),i.parent=null,!0;return!1},kt,dt,gt;wt.prototype=n,r.prototype=n,e.prototype=n,h.prototype=n,nt.prototype=h,c.prototype=n,it.prototype=n,rt.prototype=n,o.prototype=n,ut.prototype=r,i.prototype=n,l.prototype=i,ft.prototype=i,et.prototype=i,ot.prototype=i,a.prototype=i,kt=function(n,i,r,u){var f=u.timeEnd-u.timeStart;return t(n,new nt(n.vc,i,r,u.timeStart,u.top,f,u.height,{strokeStyle:u.strokeStyle?u.strokeStyle:timelineStrokeStyle,lineWidth:timelineLineWidth,fillStyle:u.fillStyle},u),!0)},s.prototype=r,w.prototype=c,dt=function(n,t){var i;if(n.type!=="infodot"||n.contentItems.length===0)return null;var u=n.width/2,f=u-infoDotHoveredBorderWidth*u,r=b(n.contentItems,n.x+n.width/2,n.y+n.height/2,f,n.vc,n.layerid);if(!r)return null;for(i=0;i<r.length;i++)if(r[i].id==t)return{x:r[i].x,y:r[i].y,width:r[i].width,height:r[i].height,parent:n};return null},gt=function(n,i,r,u,f,e,o,s){var h=new w(n.vc,i,r,u,f,e,o,s);return t(n,h,!0)}})(n.VCContent||(n.VCContent={}));var t=n.VCContent})(ChronoZoom||(ChronoZoom={}))